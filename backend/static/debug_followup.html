<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîß Debug Follow-up</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .debug-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background: #f9f9f9;
        }
        .button {
            background-color: #2196F3;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .button:hover {
            background-color: #1976D2;
        }
        .result {
            margin-top: 10px;
            padding: 10px;
            border-radius: 4px;
            background: #e3f2fd;
            border: 1px solid #2196F3;
            white-space: pre-wrap;
            font-family: monospace;
            font-size: 12px;
        }
        .error {
            background: #ffebee;
            border-color: #f44336;
            color: #c62828;
        }
        .success {
            background: #e8f5e8;
            border-color: #4caf50;
            color: #2e7d32;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß Debug da Funcionalidade Follow-up</h1>
        
        <div class="debug-section">
            <h2>1. Teste de Conectividade</h2>
            <button class="button" onclick="testConnection()">Testar Conex√£o API</button>
            <div id="connectionResult" class="result"></div>
        </div>
        
        <div class="debug-section">
            <h2>2. Teste GET Follow-ups</h2>
            <button class="button" onclick="testGetFollowups()">GET /chamados/1/followups</button>
            <div id="getResult" class="result"></div>
        </div>
        
        <div class="debug-section">
            <h2>3. Teste POST Follow-up</h2>
            <button class="button" onclick="testPostFollowup()">POST /chamados/1/followups</button>
            <div id="postResult" class="result"></div>
        </div>
        
        <div class="debug-section">
            <h2>4. Simula√ß√£o do Modal</h2>
            <button class="button" onclick="simulateModal()">Simular Cria√ß√£o via Modal</button>
            <div id="modalResult" class="result"></div>
        </div>
        
        <div class="debug-section">
            <h2>5. Debug de Rede</h2>
            <button class="button" onclick="debugNetwork()">Verificar Configura√ß√µes</button>
            <div id="networkResult" class="result"></div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8000';
        
        function log(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            element.className = `result ${type}`;
            element.textContent = message;
        }
        
        // Teste 1: Conectividade
        async function testConnection() {
            try {
                log('connectionResult', 'Testando conex√£o...');
                const response = await fetch(`${API_BASE}/`);
                const data = await response.json();
                log('connectionResult', 
                    `‚úÖ Conex√£o OK!\nStatus: ${response.status}\nResposta: ${JSON.stringify(data, null, 2)}`, 
                    'success');
            } catch (error) {
                log('connectionResult', 
                    `‚ùå Erro de conex√£o:\n${error.message}\n\nDetalhes: ${error.stack}`, 
                    'error');
            }
        }
        
        // Teste 2: GET Follow-ups
        async function testGetFollowups() {
            try {
                log('getResult', 'Buscando follow-ups...');
                const response = await fetch(`${API_BASE}/chamados/1/followups`);
                const data = await response.json();
                log('getResult', 
                    `‚úÖ GET funcionando!\nStatus: ${response.status}\nTotal: ${data.length}\nPrimeiro: ${JSON.stringify(data[0] || {}, null, 2)}`, 
                    'success');
            } catch (error) {
                log('getResult', 
                    `‚ùå Erro no GET:\n${error.message}\n\nDetalhes: ${error.stack}`, 
                    'error');
            }
        }
        
        // Teste 3: POST Follow-up
        async function testPostFollowup() {
            const followupData = {
                tipo: "Outros",
                descricao: "Follow-up de debug - teste via interface",
                autor: "Debug Frontend"
            };
            
            try {
                log('postResult', 'Enviando POST...');
                
                const response = await fetch(`${API_BASE}/chamados/1/followups`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(followupData)
                });
                
                const responseText = await response.text();
                let responseData;
                try {
                    responseData = JSON.parse(responseText);
                } catch (e) {
                    responseData = responseText;
                }
                
                if (response.ok) {
                    log('postResult', 
                        `‚úÖ POST funcionando!\nStatus: ${response.status}\nResposta: ${JSON.stringify(responseData, null, 2)}`, 
                        'success');
                } else {
                    log('postResult', 
                        `‚ùå POST falhou!\nStatus: ${response.status}\nResposta: ${JSON.stringify(responseData, null, 2)}`, 
                        'error');
                }
            } catch (error) {
                log('postResult', 
                    `‚ùå Erro no POST:\n${error.message}\n\nDetalhes: ${error.stack}`, 
                    'error');
            }
        }
        
        // Teste 4: Simula√ß√£o do Modal
        async function simulateModal() {
            // Simula exatamente o que o modal faz
            const followupData = {
                tipo: "An√°lise",
                descricao: "Este √© um teste exato do que o modal deveria enviar",
                autor: "Usu√°rio Sistema"
            };
            
            try {
                log('modalResult', 'Simulando envio do modal...');
                
                const response = await fetch(`${API_BASE}/chamados/1/followups`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(followupData)
                });
                
                if (response.ok) {
                    const resultado = await response.json();
                    log('modalResult', 
                        `‚úÖ Modal simulation funcionando!\nID: ${resultado.id}\nTipo: ${resultado.tipo}\nDescri√ß√£o: ${resultado.descricao.substring(0, 50)}...`, 
                        'success');
                } else {
                    const erro = await response.json();
                    log('modalResult', 
                        `‚ùå Erro no modal simulation:\n${JSON.stringify(erro, null, 2)}`, 
                        'error');
                }
            } catch (error) {
                log('modalResult', 
                    `‚ùå Erro na simula√ß√£o:\n${error.message}\n\nStack: ${error.stack}`, 
                    'error');
            }
        }
        
        // Teste 5: Debug de Rede
        function debugNetwork() {
            const debug = {
                userAgent: navigator.userAgent,
                location: window.location.href,
                origin: window.location.origin,
                apiBase: API_BASE,
                cors: {
                    mode: 'cors',
                    credentials: 'include'
                },
                timestamp: new Date().toISOString()
            };
            
            log('networkResult', 
                `üîç Configura√ß√µes de Debug:\n${JSON.stringify(debug, null, 2)}`, 
                'info');
        }
        
        // Auto-executar alguns testes
        window.onload = function() {
            log('connectionResult', 'Clique para testar a conex√£o');
            log('getResult', 'Clique para testar GET');
            log('postResult', 'Clique para testar POST');
            log('modalResult', 'Clique para simular o modal');
            log('networkResult', 'Clique para ver configura√ß√µes');
        };
    </script>
</body>
</html>