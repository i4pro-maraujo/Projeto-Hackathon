<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WEX Intelligence - Sistema de Triagem Autom√°tica</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f5f5;
            color: #333;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 1rem 2rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: 1.8rem;
            font-weight: 600;
        }

        .header p {
            opacity: 0.9;
            margin-top: 0.5rem;
        }

        .container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 1rem;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .metric-card {
            background: white;
            padding: 1.5rem;
            border-radius: 10px;
            box-shadow: 0 2px 15px rgba(0,0,0,0.1);
            border-left: 4px solid;
        }

        .metric-card.total { border-left-color: #3498db; }
        .metric-card.critical { border-left-color: #e74c3c; }
        .metric-card.resolved { border-left-color: #2ecc71; }
        .metric-card.average { border-left-color: #f39c12; }

        .metric-value {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }

        .metric-label {
            color: #666;
            font-size: 0.9rem;
        }

        /* Estilos para Dashboard Avan√ßado */
        .dashboard-advanced {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .chart-container {
            background: white;
            padding: 1.5rem;
            border-radius: 10px;
            box-shadow: 0 2px 15px rgba(0,0,0,0.1);
            position: relative;
            height: 400px;
        }

        .chart-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: #2c3e50;
            text-align: center;
        }

        .chart-canvas {
            max-height: 300px;
            width: 100% !important;
            height: 300px !important;
        }

        .sla-indicators {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .sla-card {
            background: white;
            padding: 1rem;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: center;
            border-top: 3px solid;
        }

        .sla-card.green { border-top-color: #2ecc71; }
        .sla-card.yellow { border-top-color: #f39c12; }
        .sla-card.red { border-top-color: #e74c3c; }

        .sla-time {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 0.3rem;
        }

        .sla-label {
            font-size: 0.8rem;
            color: #666;
        }

        /* Indicadores de alerta */
        .alert-badge {
            display: inline-block;
            padding: 0.2rem 0.5rem;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: bold;
            margin-left: 0.5rem;
        }

        .alert-badge.critical {
            background-color: #e74c3c;
            color: white;
            animation: pulse 2s infinite;
        }

        .alert-badge.warning {
            background-color: #f39c12;
            color: white;
        }

        .alert-badge.info {
            background-color: #3498db;
            color: white;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        /* Loading states */
        .loading-skeleton {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: loading 2s infinite;
            border-radius: 4px;
            height: 20px;
            margin-bottom: 0.5rem;
        }

        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        /* Modal para visualiza√ß√£o detalhada */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }

        .modal-content {
            background-color: white;
            margin: 2% auto;
            padding: 2rem;
            border-radius: 10px;
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid #ecf0f1;
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: #2c3e50;
        }

        .close {
            color: #aaa;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            line-height: 1;
        }

        .close:hover {
            color: #000;
        }

        .chamado-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .detail-item {
            padding: 0.8rem;
            background-color: #f8f9fa;
            border-radius: 5px;
            border-left: 3px solid #3498db;
        }

        .detail-label {
            font-weight: 600;
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 0.3rem;
        }

        .detail-value {
            color: #333;
            font-size: 1rem;
        }

        .followups-section {
            margin-top: 2rem;
        }

        .followup-timeline {
            position: relative;
            padding-left: 2rem;
        }

        .followup-timeline::before {
            content: '';
            position: absolute;
            left: 0.5rem;
            top: 0;
            bottom: 0;
            width: 2px;
            background: #ddd;
        }

        .followup-item {
            position: relative;
            margin-bottom: 1.5rem;
            background: white;
            padding: 1rem;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .followup-item::before {
            content: '';
            position: absolute;
            left: -1.8rem;
            top: 1rem;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #3498db;
            border: 2px solid white;
        }

        .followup-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .followup-autor {
            font-weight: 600;
            color: #2c3e50;
        }

        .followup-data {
            font-size: 0.9rem;
            color: #666;
        }

        .followup-tipo {
            padding: 0.2rem 0.5rem;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 500;
            background-color: #e3f2fd;
            color: #1976d2;
        }

        .metric-trend {
            font-size: 0.8rem;
            margin-top: 0.3rem;
        }

        .trend-up {
            color: #2ecc71;
        }

        .trend-down {
            color: #e74c3c;
        }

        .trend-stable {
            color: #95a5a6;
        }

        .content-section {
            background: white;
            border-radius: 10px;
            padding: 1.5rem;
            box-shadow: 0 2px 15px rgba(0,0,0,0.1);
            margin-bottom: 1.5rem;
        }

        .section-title {
            font-size: 1.3rem;
            margin-bottom: 1rem;
            color: #2c3e50;
            border-bottom: 2px solid #ecf0f1;
            padding-bottom: 0.5rem;
        }

        .filters {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 0.3rem;
        }

        .filter-group label {
            font-size: 0.9rem;
            color: #666;
        }

        .filter-group select, .filter-group input {
            padding: 0.5rem;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 0.9rem;
        }
        
        /* Melhorias para selects m√∫ltiplos */
        .filter-group select[multiple] {
            min-height: 80px;
            max-height: 120px;
            background: linear-gradient(135deg, #f8f9fa, #ffffff);
            border: 2px solid #e9ecef;
            border-radius: 8px;
            padding: 8px;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            transition: all 0.3s ease;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .filter-group select[multiple]:focus {
            border-color: #007bff;
            box-shadow: 0 0 0 3px rgba(0,123,255,0.25);
            outline: none;
        }
        
        .filter-group select[multiple] option {
            padding: 6px 10px;
            margin: 2px 0;
            border-radius: 4px;
            background-color: white;
            transition: all 0.2s ease;
        }
        
        .filter-group select[multiple] option:hover {
            background-color: #f8f9fa;
        }
        
        .filter-group select[multiple] option:checked {
            background: linear-gradient(135deg, #007bff, #0056b3);
            color: white;
            font-weight: 500;
        }
        
        /* Indicador visual para sele√ß√£o m√∫ltipla */
        .filter-group label {
            position: relative;
        }
        
        .filter-group:has(select[multiple]) label::after {
            content: "üìã Multi-sele√ß√£o";
            font-size: 0.7rem;
            color: #6c757d;
            background: #e9ecef;
            padding: 2px 6px;
            border-radius: 10px;
            margin-left: 8px;
            white-space: nowrap;
        }

        .btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: background-color 0.3s;
        }

        .btn-primary {
            background-color: #3498db;
            color: white;
        }

        .btn-primary:hover {
            background-color: #2980b9;
        }

        .btn-secondary {
            background-color: #95a5a6;
            color: white;
        }

        .btn-secondary:hover {
            background-color: #7f8c8d;
        }

        .table-container {
            overflow-x: auto;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }

        .table th, .table td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        .table th {
            background-color: #f8f9fa;
            font-weight: 600;
            color: #2c3e50;
        }

        .table tr:hover {
            background-color: #f8f9fa;
        }

        .status-badge {
            padding: 0.25rem 0.5rem;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .status-aberto { background-color: #e3f2fd; color: #1976d2; }
        .status-em-analise { background-color: #fff3e0; color: #f57c00; }
        .status-pendente { background-color: #fce4ec; color: #c2185b; }
        .status-resolvido { background-color: #e8f5e8; color: #388e3c; }
        .status-fechado { background-color: #f5f5f5; color: #616161; }

        .criticidade-badge {
            padding: 0.25rem 0.5rem;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .criticidade-baixa { background-color: #e8f5e8; color: #388e3c; }
        .criticidade-media { background-color: #fff3e0; color: #f57c00; }
        .criticidade-alta { background-color: #ffebee; color: #d32f2f; }
        .criticidade-critica { background-color: #ffcdd2; color: #b71c1c; }

        .loading {
            text-align: center;
            color: #666;
            padding: 2rem;
        }

        .error {
            background-color: #ffebee;
            color: #c62828;
            padding: 1rem;
            border-radius: 5px;
            margin: 1rem 0;
        }

        .pagination {
            display: flex;
            justify-content: center;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .pagination button {
            padding: 0.5rem 1rem;
            border: 1px solid #ddd;
            background: white;
            cursor: pointer;
            border-radius: 3px;
        }

        .pagination button.active {
            background-color: #3498db;
            color: white;
            border-color: #3498db;
        }

        .pagination button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Toast Notifications */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 10000;
            max-width: 350px;
        }
        
        .toast {
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            margin-bottom: 10px;
            padding: 16px;
            border-left: 4px solid;
            animation: slideInRight 0.3s ease-out;
            opacity: 0;
            transform: translateX(100%);
        }
        
        .toast.show {
            opacity: 1;
            transform: translateX(0);
        }
        
        .toast.toast-success {
            border-left-color: #28a745;
        }
        
        .toast.toast-error {
            border-left-color: #dc3545;
        }
        
        .toast.toast-warning {
            border-left-color: #ffc107;
        }
        
        .toast.toast-info {
            border-left-color: #17a2b8;
        }
        
        .toast-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .toast-title {
            font-weight: 600;
            font-size: 14px;
        }
        
        .toast-close {
            background: none;
            border: none;
            font-size: 18px;
            cursor: pointer;
            color: #6c757d;
            padding: 0;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .toast-close:hover {
            color: #343a40;
        }
        
        .toast-body {
            font-size: 13px;
            color: #6c757d;
            line-height: 1.4;
        }
        
        /* Badges para Chamados */
        .chamado-badges {
            display: flex;
            gap: 4px;
            margin-top: 4px;
        }
        
        .badge {
            padding: 2px 6px;
            border-radius: 12px;
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .badge-critico-vencido {
            background: #dc3545;
            color: white;
            animation: pulse 2s infinite;
        }
        
        .badge-critico-proximo {
            background: #fd7e14;
            color: white;
        }
        
        .badge-novo {
            background: #007bff;
            color: white;
        }
        
        .badge-sla-ok {
            background: #28a745;
            color: white;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.6; }
            100% { opacity: 1; }
        }
        
        /* Contador de Notifica√ß√µes no Header */
        .notification-counter {
            position: relative;
            display: inline-block;
            margin-left: 20px;
        }
        
        .notification-bell {
            font-size: 20px;
            color: #6c757d;
            cursor: pointer;
            transition: color 0.3s ease;
        }
        
        .notification-bell:hover {
            color: #007bff;
        }
        
        .notification-badge {
            position: absolute;
            top: -8px;
            right: -8px;
            background: #dc3545;
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            font-size: 10px;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            min-width: 18px;
        }
        
        .notification-badge.hidden {
            display: none;
        }
        
        /* Alertas Visuais */
        .alert-banner {
            position: fixed;
            top: 80px; /* Abaixo do header */
            left: 0;
            right: 0;
            z-index: 1000;
            background: linear-gradient(135deg, #dc3545, #fd7e14);
            color: white;
            padding: 12px 20px;
            text-align: center;
            font-weight: 600;
            animation: slideDown 0.5s ease-out;
            margin-bottom: 10px;
        }
        
        .alert-banner.warning {
            background: linear-gradient(135deg, #ffc107, #fd7e14);
            color: #212529;
        }
        
        .alert-banner.info {
            background: linear-gradient(135deg, #17a2b8, #007bff);
        }
        
        .alert-banner.success {
            background: linear-gradient(135deg, #28a745, #20c997);
        }
        
        /* Ajuste para evitar sobreposi√ß√£o */
        .container {
            margin-top: 20px;
        }
        
        .container.with-alert {
            margin-top: 80px;
        }
        
        @keyframes slideDown {
            from {
                transform: translateY(-100%);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        /* Estados de Loading */
        .loading-state {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            color: #6c757d;
            font-size: 14px;
        }
        
        .loading-spinner {
            width: 16px;
            height: 16px;
            border: 2px solid #e9ecef;
            border-top: 2px solid #007bff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Responsividade */
        @media (max-width: 768px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .filters {
                flex-direction: column;
                gap: 10px;
            }
            
            .pagination {
                flex-direction: column;
                gap: 10px;
            }
            
            .modal-content {
                margin: 10px;
                max-width: calc(100vw - 20px);
            }
            
            .toast-container {
                top: 10px;
                right: 10px;
                left: 10px;
                max-width: none;
            }
            
            /* Mobile: Esconder colunas menos importantes */
            .table th:nth-child(7),
            .table td:nth-child(7),
            .table th:nth-child(8),
            .table td:nth-child(8) {
                display: none;
            }
            
            .header h1 {
                font-size: 1.5rem;
            }
            
            .header p {
                font-size: 0.9rem;
            }
            
            .notification-counter {
                margin-left: 10px;
            }
        }
        
        @media (max-width: 480px) {
            /* Mobile small: Ainda menos colunas */
            .table th:nth-child(5),
            .table td:nth-child(5),
            .table th:nth-child(6),
            .table td:nth-child(6) {
                display: none;
            }
            
            .metric-card {
                padding: 15px;
            }
            
            .metric-value {
                font-size: 1.8rem;
            }
            
            .dashboard-grid.avancado {
                grid-template-columns: 1fr;
                gap: 10px;
            }
        }
        
        @media (min-width: 769px) and (max-width: 1024px) {
            /* Tablet */
            .dashboard-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 20px;
            }
            
            .dashboard-grid.avancado {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        @media (min-width: 1025px) {
            /* Desktop */
            .dashboard-grid {
                grid-template-columns: repeat(4, 1fr);
            }
            
            .dashboard-grid.avancado {
                grid-template-columns: repeat(2, 1fr);
                gap: 25px;
            }
        }
        
        /* Anima√ß√µes e Transi√ß√µes */
        * {
            transition: all 0.3s ease;
        }
        
        .metric-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }
        
        .table tr:hover {
            background-color: #f8f9fa;
            transform: scale(1.01);
        }
        
        .clickable-row {
            cursor: pointer;
        }
        
        .clickable-row:hover {
            background-color: #e3f2fd !important;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        .chart-container:hover {
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }
        
        /* Skeleton Loading */
        .skeleton {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
        }
        
        @keyframes loading {
            0% {
                background-position: 200% 0;
            }
            100% {
                background-position: -200% 0;
            }
        }
        
        .skeleton-text {
            height: 20px;
            border-radius: 4px;
            margin-bottom: 8px;
        }
        
        .skeleton-card {
            height: 100px;
            border-radius: 8px;
        }
        
        /* Estados de Bot√µes */
        .btn {
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }
        
        .btn.loading {
            color: transparent;
            pointer-events: none;
        }
        
        .btn.loading::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 16px;
            height: 16px;
            margin: -8px 0 0 -8px;
            border: 2px solid #fff;
            border-top: 2px solid transparent;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        .btn.success {
            background-color: #28a745;
            border-color: #28a745;
        }
        
        .btn.error {
            background-color: #dc3545;
            border-color: #dc3545;
        }
        
        /* Acessibilidade */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }
        
        button:focus,
        input:focus,
        select:focus {
            outline: 2px solid #007bff;
            outline-offset: 2px;
        }
        
        /* High Contrast Mode */
        @media (prefers-contrast: high) {
            .metric-card {
                border: 2px solid #000;
            }
            
            .status-badge,
            .criticidade-badge {
                border: 1px solid #000;
            }
        }
        
        /* Highlight de busca */
        .highlight, .search-highlight {
            background: #ffeb3b;
            padding: 1px 2px;
            border-radius: 2px;
            font-weight: bold;
        }
        
        /* Modal Aprimorado */
        .modal-content-enhanced {
            max-width: 900px;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .modal-header-enhanced {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            border-bottom: 2px solid #e9ecef;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .modal-title-enhanced {
            font-size: 1.5rem;
            font-weight: bold;
            margin: 0;
        }
        
        .chamado-score-display {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .score-circle {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2rem;
            color: white;
            position: relative;
        }
        
        .score-circle.score-alto {
            background: conic-gradient(#28a745 0deg 252deg, #e9ecef 252deg 360deg);
        }
        
        .score-circle.score-medio {
            background: conic-gradient(#ffc107 0deg 216deg, #e9ecef 216deg 360deg);
        }
        
        .score-circle.score-baixo {
            background: conic-gradient(#dc3545 0deg 180deg, #e9ecef 180deg 360deg);
        }
        
        .score-circle::before {
            content: '';
            position: absolute;
            width: 40px;
            height: 40px;
            background: white;
            border-radius: 50%;
            z-index: 1;
        }
        
        .score-text {
            position: relative;
            z-index: 2;
            color: #333;
            font-size: 14px;
        }
        
        .modal-body-enhanced {
            padding: 0;
        }
        
        .chamado-info-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
            padding: 20px;
        }
        
        .info-principais {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
        }
        
        .info-lateral {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .info-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .info-card h4 {
            margin: 0 0 10px 0;
            color: #495057;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .timeline-vertical {
            position: relative;
            padding-left: 30px;
            margin-top: 20px;
        }
        
        .timeline-vertical::before {
            content: '';
            position: absolute;
            left: 15px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: #dee2e6;
        }
        
        .timeline-item-enhanced {
            position: relative;
            margin-bottom: 20px;
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .timeline-item-enhanced::before {
            content: '';
            position: absolute;
            left: -22px;
            top: 15px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #007bff;
            border: 3px solid white;
            box-shadow: 0 0 0 2px #007bff;
        }
        
        .timeline-item-enhanced.tipo-desenvolvimento::before {
            background: #28a745;
            box-shadow: 0 0 0 2px #28a745;
        }
        
        .timeline-item-enhanced.tipo-analise::before {
            background: #ffc107;
            box-shadow: 0 0 0 2px #ffc107;
        }
        
        .timeline-item-enhanced.tipo-outros::before {
            background: #6c757d;
            box-shadow: 0 0 0 2px #6c757d;
        }
        
        .timeline-header-enhanced {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .timeline-tipo-enhanced {
            background: #e9ecef;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .timeline-data-enhanced {
            color: #6c757d;
            font-size: 0.8rem;
        }
        
        .timeline-conteudo-enhanced {
            color: #495057;
            line-height: 1.5;
        }
        
        .modal-actions {
            padding: 20px;
            border-top: 1px solid #e9ecef;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 10px;
        }
        
        .btn-action {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .btn-primary-action {
            background: #007bff;
            color: white;
        }
        
        .btn-secondary-action {
            background: #6c757d;
            color: white;
        }
        
        .btn-success-action {
            background: #28a745;
            color: white;
        }
        
        .btn-action:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        /* Anexos Simulados */
        .anexos-section {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .anexos-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }
        
        .anexo-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px;
            background: white;
            border-radius: 6px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .anexo-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .anexo-icon {
            font-size: 2rem;
            margin-bottom: 8px;
        }
        
        .anexo-nome {
            font-size: 0.8rem;
            text-align: center;
            color: #495057;
            word-break: break-word;
        }
        
        .anexo-tamanho {
            font-size: 0.7rem;
            color: #6c757d;
            margin-top: 2px;
        }
        
        /* Preview de Imagem */
        .image-preview-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10001;
        }
        
        .image-preview-content {
            max-width: 90%;
            max-height: 90%;
            position: relative;
        }
        
        .image-preview-content img {
            max-width: 100%;
            max-height: 100%;
            border-radius: 8px;
        }
        
        .image-preview-close {
            position: absolute;
            top: -40px;
            right: 0;
            background: none;
            border: none;
            color: white;
            font-size: 2rem;
            cursor: pointer;
        }
        
        /* Pagina√ß√£o Avan√ßada */
        .pagination-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 20px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .pagination-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .pagination-controls {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .pagination-btn {
            padding: 8px 12px;
            border: 1px solid #dee2e6;
            background: white;
            color: #495057;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .pagination-btn:hover:not(:disabled) {
            background: #007bff;
            color: white;
            border-color: #007bff;
        }
        
        .pagination-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .pagination-btn.active {
            background: #007bff;
            color: white;
            border-color: #007bff;
        }
        
        .page-size-selector {
            padding: 6px 10px;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            background: white;
        }
        
        .pagination-stats {
            font-size: 0.9rem;
            color: #6c757d;
        }
        
        .search-operators {
            font-size: 11px;
            color: #6c757d;
            margin-top: 4px;
        }
        
        .search-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            font-size: 12px;
            color: #6c757d;
        }
        
        .search-results-count {
            font-weight: 600;
        }
        
        /* ===== ESTILOS SE√á√ÉO IA ===== */
        .ia-nav {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
            border-bottom: 2px solid #e9ecef;
            padding-bottom: 1rem;
        }
        
        .ia-nav-btn {
            padding: 0.75rem 1.5rem;
            border: 2px solid #667eea;
            background: transparent;
            color: #667eea;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .ia-nav-btn:hover {
            background: #667eea;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }
        
        .ia-nav-btn.active {
            background: #667eea;
            color: white;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }
        
        .ia-module {
            margin-bottom: 2rem;
        }
        
        .ia-card {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            border: 1px solid #e9ecef;
        }
        
        .ia-card h3 {
            color: #667eea;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .ia-card p {
            color: #6c757d;
            margin-bottom: 2rem;
            line-height: 1.6;
        }
        
        .ia-input-group {
            background: #f8f9fa;
            padding: 1.5rem;
            border-radius: 8px;
            margin-bottom: 2rem;
        }
        
        .ia-input-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #495057;
        }
        
        .ia-input-group select,
        .ia-input-group input {
            width: 100%;
            max-width: 300px;
            padding: 0.75rem;
            border: 1px solid #ced4da;
            border-radius: 6px;
            margin-bottom: 1rem;
            margin-right: 1rem;
        }
        
        .ia-input-group .btn {
            margin-top: 1rem;
        }
        
        .parametros-busca {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .ia-resultado {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 2rem;
            border-left: 4px solid #667eea;
        }
        
        .ia-resultado h4 {
            color: #667eea;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .ia-resultado h5 {
            color: #495057;
            margin: 1.5rem 0 1rem 0;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .resultado-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }
        
        .resultado-item {
            background: white;
            padding: 1rem;
            border-radius: 6px;
            border: 1px solid #dee2e6;
        }
        
        .resultado-item label {
            display: block;
            font-weight: 600;
            color: #6c757d;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
        }
        
        .resultado-item span {
            font-weight: 600;
            font-size: 1.1rem;
        }
        
        .fatores-identificados,
        .sugestoes-melhoria,
        .tags-sugeridas,
        .contexto-chamado,
        .sugestoes-principais,
        .historico-exemplos,
        .padroes-identificados,
        .padroes-globais,
        .clientes-ranking {
            background: white;
            padding: 1.5rem;
            border-radius: 6px;
            margin-bottom: 1rem;
            border: 1px solid #dee2e6;
        }
        
        .fator-item,
        .sugestao-item,
        .tag-item,
        .contexto-item,
        .padrao-item {
            background: #e3f2fd;
            padding: 0.75rem;
            border-radius: 6px;
            margin-bottom: 0.5rem;
            border-left: 3px solid #2196f3;
        }
        
        .sugestao-item {
            background: #f3e5f5;
            border-left-color: #9c27b0;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .sugestao-item:hover {
            background: #e1bee7;
            transform: translateX(5px);
        }
        
        .relacionado-item {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            padding: 1rem;
            margin-bottom: 1rem;
            transition: all 0.2s ease;
        }
        
        .relacionado-item:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }
        
        .relacionado-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 0.5rem;
        }
        
        .relacionado-score {
            background: #28a745;
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .relacionado-motivos {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }
        
        .motivo-tag {
            background: #17a2b8;
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.8rem;
        }
        
        .acoes-triagem,
        .acoes-sugestoes {
            display: flex;
            gap: 1rem;
            margin-top: 2rem;
            flex-wrap: wrap;
        }
        
        .metricas-ia {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }
        
        .metric-card-ia {
            background: white;
            padding: 1.5rem;
            border-radius: 8px;
            border: 1px solid #dee2e6;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .metric-value-ia {
            font-size: 2.5rem;
            font-weight: 700;
            color: #667eea;
            margin-bottom: 0.5rem;
        }
        
        .metric-label-ia {
            color: #6c757d;
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.8rem;
            letter-spacing: 0.5px;
        }
        
        .chamado-principal {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 6px;
            padding: 1rem;
            margin-bottom: 1rem;
        }
        
        .badge-ia {
            padding: 0.3rem 0.6rem;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 600;
            color: white;
        }
        
        .badge-ia.critica { background: #dc3545; }
        .badge-ia.alta { background: #fd7e14; }
        .badge-ia.media { background: #ffc107; color: #212529; }
        .badge-ia.baixa { background: #28a745; }
        
        .hidden {
            display: none !important;
        }
        
        /* Responsividade IA */
        @media (max-width: 768px) {
            .ia-nav {
                flex-direction: column;
            }
            
            .ia-nav-btn {
                width: 100%;
                justify-content: center;
            }
            
            .resultado-grid {
                grid-template-columns: 1fr;
            }
            
            .metricas-ia {
                grid-template-columns: 1fr;
            }
            
            .parametros-busca {
                grid-template-columns: 1fr;
            }
            
            .acoes-triagem,
            .acoes-sugestoes {
                flex-direction: column;
            }
        }
        
        /* Reduced Motion */
        @media (prefers-reduced-motion: reduce) {
            *,
            *::before,
            *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <div>
                <h1>üéØ WEX Intelligence</h1>
                <p>Sistema de Triagem Autom√°tica de Chamados</p>
            </div>
            <div class="notification-counter">
                <span class="notification-bell" onclick="toggleNotificationPanel()" title="Notifica√ß√µes">üîî</span>
                <span class="notification-badge hidden" id="notificationBadge">0</span>
            </div>
        </div>
    </header>

    <!-- Alert Banner -->
    <div id="alertBanner" class="alert-banner" style="display: none;"></div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <div class="container">
        <!-- Dashboard Metrics -->
        <div class="dashboard-grid" id="dashboardMetrics">
            <div class="metric-card total">
                <div class="metric-value" id="totalChamados">-</div>
                <div class="metric-label">Total de Chamados</div>
            </div>
            <div class="metric-card critical">
                <div class="metric-value" id="chamadosCriticos">-</div>
                <div class="metric-label">Chamados Cr√≠ticos</div>
            </div>
            <div class="metric-card resolved">
                <div class="metric-value" id="chamadosHoje">-</div>
                <div class="metric-label">Novos Hoje</div>
            </div>
            <div class="metric-card average">
                <div class="metric-value" id="tempoMedio">-</div>
                <div class="metric-label">Tempo M√©dio (horas)</div>
            </div>
        </div>

        <!-- Dashboard Avan√ßado com Gr√°ficos -->
        <div class="content-section">
            <h2 class="section-title">üìä Dashboard Avan√ßado</h2>
            
            <!-- Indicadores de SLA -->
            <div class="sla-indicators">
                <div class="sla-card green">
                    <div class="sla-time" id="slaOk">-</div>
                    <div class="sla-label">Dentro do SLA</div>
                </div>
                <div class="sla-card yellow">
                    <div class="sla-time" id="slaWarning">-</div>
                    <div class="sla-label">Pr√≥ximo ao Vencimento</div>
                </div>
                <div class="sla-card red">
                    <div class="sla-time" id="slaExpired">-</div>
                    <div class="sla-label">SLA Vencido</div>
                </div>
            </div>

            <!-- Gr√°ficos -->
            <div class="dashboard-advanced">
                <div class="chart-container">
                    <div class="chart-title">üìà Distribui√ß√£o por Status</div>
                    <canvas id="statusChart" class="chart-canvas"></canvas>
                </div>
                <div class="chart-container">
                    <div class="chart-title">üî• Distribui√ß√£o por Criticidade</div>
                    <canvas id="criticidadeChart" class="chart-canvas"></canvas>
                </div>
                <div class="chart-container">
                    <div class="chart-title">üìÖ Volume por Dia (√öltimos 7 dias)</div>
                    <canvas id="volumeChart" class="chart-canvas"></canvas>
                </div>
                <div class="chart-container">
                    <div class="chart-title">‚è±Ô∏è Tend√™ncia de Resolu√ß√£o</div>
                    <canvas id="tendenciaChart" class="chart-canvas"></canvas>
                </div>
            </div>
        </div>

        <!-- Chamados List -->
        <div class="content-section">
            <h2 class="section-title">üìã Lista de Chamados</h2>
            
            <div class="filters">
                <div class="filter-group">
                    <label>Status:</label>
                    <select id="filtroStatus" multiple>
                        <option value="Aberto">Aberto</option>
                        <option value="Em an√°lise">Em an√°lise</option>
                        <option value="Pendente">Pendente</option>
                        <option value="Resolvido">Resolvido</option>
                        <option value="Fechado">Fechado</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>Criticidade:</label>
                    <select id="filtroCriticidade" multiple>
                        <option value="Baixa">Baixa</option>
                        <option value="M√©dia">M√©dia</option>
                        <option value="Alta">Alta</option>
                        <option value="Cr√≠tica">Cr√≠tica</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>Cliente:</label>
                    <select id="filtroClienteDropdown">
                        <option value="">Todos os clientes</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>Data In√≠cio:</label>
                    <input type="date" id="filtroDataInicio">
                </div>
                <div class="filter-group">
                    <label>Data Fim:</label>
                    <input type="date" id="filtroDataFim">
                </div>
                <div class="filter-group">
                    <label>Busca Avan√ßada:</label>
                    <input type="text" id="filtroBusca" placeholder="Buscar em descri√ß√£o e follow-ups...">
                    <div class="search-operators">
                        Use operadores: <span class="search-highlight">"termo1 AND termo2"</span>, <span class="search-highlight">"termo1 OR termo2"</span>, <span class="search-highlight">"termo exato"</span>
                    </div>
                </div>
                <div class="filter-group">
                    <label>&nbsp;</label>
                    <button class="btn btn-primary" onclick="carregarChamados()">üîç Filtrar</button>
                </div>
                <div class="filter-group">
                    <label>&nbsp;</label>
                    <button class="btn btn-secondary" onclick="limparFiltros()">üóëÔ∏è Limpar</button>
                </div>
            </div>

            <div class="table-container">
                <table class="table">
                    <thead>
                        <tr>
                            <th onclick="ordenarPor('numero_wex')" style="cursor: pointer;">N¬∫ WEX ‚áÖ</th>
                            <th onclick="ordenarPor('status')" style="cursor: pointer;">Status ‚áÖ</th>
                            <th onclick="ordenarPor('descricao')" style="cursor: pointer;">Descri√ß√£o ‚áÖ</th>
                            <th onclick="ordenarPor('cliente_solicitante')" style="cursor: pointer;">Cliente ‚áÖ</th>
                            <th onclick="ordenarPor('criticidade')" style="cursor: pointer;">Criticidade ‚áÖ</th>
                            <th onclick="ordenarPor('score_qualidade')" style="cursor: pointer;">Score ‚áÖ</th>
                            <th onclick="ordenarPor('data_criacao')" style="cursor: pointer;">Criado em ‚áÖ</th>
                            <th>√öltima Atualiza√ß√£o</th>
                        </tr>
                    </thead>
                    <tbody id="chamadosTableBody">
                        <tr>
                            <td colspan="8" class="loading">Carregando chamados...</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="pagination-container">
                <div class="pagination-info">
                    <div class="pagination-stats" id="paginationStats">
                        Mostrando 0-0 de 0 resultados
                    </div>
                    <div>
                        <label for="pageSize">Itens por p√°gina:</label>
                        <select id="pageSize" class="page-size-selector" onchange="mudarTamanhoPagina()">
                            <option value="5">5</option>
                            <option value="10" selected>10</option>
                            <option value="20">20</option>
                            <option value="50">50</option>
                        </select>
                    </div>
                </div>
                
                <div class="pagination-controls" id="paginationControls">
                    <button class="pagination-btn" id="btnPrimeira" onclick="irParaPagina(1)" disabled>‚èÆÔ∏è</button>
                    <button class="pagination-btn" id="btnAnterior" onclick="paginaAnterior()" disabled>‚¨ÖÔ∏è</button>
                    <span id="paginasNumeros"></span>
                    <button class="pagination-btn" id="btnProxima" onclick="proximaPagina()" disabled>‚û°Ô∏è</button>
                    <button class="pagination-btn" id="btnUltima" onclick="irParaUltimaPagina()" disabled>‚è≠Ô∏è</button>
                </div>
            </div>
        </div>

        <!-- Se√ß√£o de IA Intelligence -->
        <div class="content-section" id="iaSection">
            <h2 class="section-title">ü§ñ IA Intelligence - Sistema Inteligente</h2>
            
            <!-- Navega√ß√£o entre m√≥dulos de IA -->
            <div class="ia-nav">
                <button class="ia-nav-btn active" onclick="mostrarModuloIA('triagem')">
                    üéØ Triagem Autom√°tica
                </button>
                <button class="ia-nav-btn" onclick="mostrarModuloIA('sugestoes')">
                    üí° Sugest√µes de Follow-up
                </button>
                <button class="ia-nav-btn" onclick="mostrarModuloIA('relacionados')">
                    üîó Chamados Relacionados
                </button>
                <button class="ia-nav-btn" onclick="mostrarModuloIA('relatorios')">
                    üìä Relat√≥rios de IA
                </button>
            </div>

            <!-- M√≥dulo de Triagem Autom√°tica -->
            <div id="moduloTriagem" class="ia-module">
                <div class="ia-card">
                    <h3>üéØ Sistema de Triagem Autom√°tica</h3>
                    <p>Analise chamados automaticamente para sugerir criticidade e melhorias.</p>
                    
                    <div class="ia-input-group">
                        <label>Selecionar Chamado para Triagem:</label>
                        <select id="selectChamadoTriagem">
                            <option value="">Carregando chamados...</option>
                        </select>
                        <button class="btn btn-primary" onclick="executarTriagem()">
                            üîç Executar Triagem
                        </button>
                    </div>
                    
                    <div id="resultadoTriagem" class="ia-resultado hidden">
                        <h4>üìã Resultado da An√°lise</h4>
                        <div class="resultado-grid">
                            <div class="resultado-item">
                                <label>Criticidade Atual:</label>
                                <span id="criticidadeAtual" class="badge"></span>
                            </div>
                            <div class="resultado-item">
                                <label>Criticidade Sugerida:</label>
                                <span id="criticidadeSugerida" class="badge"></span>
                            </div>
                            <div class="resultado-item">
                                <label>Confian√ßa:</label>
                                <span id="confiancaTriagem"></span>
                            </div>
                            <div class="resultado-item">
                                <label>Score Qualidade:</label>
                                <span id="scoreQualidade"></span>
                            </div>
                        </div>
                        
                        <div class="fatores-identificados">
                            <h5>üîç Fatores Identificados:</h5>
                            <div id="fatoresLista"></div>
                        </div>
                        
                        <div class="sugestoes-melhoria">
                            <h5>üí° Sugest√µes de Melhoria:</h5>
                            <div id="sugestoesLista"></div>
                        </div>
                        
                        <div class="tags-sugeridas">
                            <h5>üè∑Ô∏è Tags Sugeridas:</h5>
                            <div id="tagsLista"></div>
                        </div>
                        
                        <div class="acoes-triagem">
                            <button class="btn btn-success" onclick="aplicarTriagem()">
                                ‚úÖ Aplicar Sugest√µes
                            </button>
                            <button class="btn btn-secondary" onclick="limparTriagem()">
                                üóëÔ∏è Limpar
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- M√≥dulo de Sugest√µes de Follow-up -->
            <div id="moduloSugestoes" class="ia-module hidden">
                <div class="ia-card">
                    <h3>üí° Sugest√µes Inteligentes de Follow-up</h3>
                    <p>Receba sugest√µes contextuais para pr√≥ximas a√ß√µes baseadas no hist√≥rico.</p>
                    
                    <div class="ia-input-group">
                        <label>Selecionar Chamado:</label>
                        <select id="selectChamadoSugestao">
                            <option value="">Carregando chamados...</option>
                        </select>
                        <button class="btn btn-primary" onclick="obterSugestoes()">
                            üí° Obter Sugest√µes
                        </button>
                    </div>
                    
                    <div id="resultadoSugestoes" class="ia-resultado hidden">
                        <h4>üìù Sugest√µes Personalizadas</h4>
                        
                        <div class="contexto-chamado">
                            <h5>üìä Contexto do Chamado:</h5>
                            <div id="contextoChamado"></div>
                        </div>
                        
                        <div class="sugestoes-principais">
                            <h5>‚≠ê Sugest√µes Principais:</h5>
                            <div id="sugestoesPrincipais"></div>
                        </div>
                        
                        <div class="historico-exemplos">
                            <h5>üìö Exemplos do Hist√≥rico:</h5>
                            <div id="exemplosSimilares"></div>
                        </div>
                        
                        <div class="acoes-sugestoes">
                            <button class="btn btn-success" onclick="criarFollowupSugerido()">
                                ‚ûï Criar Follow-up
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- M√≥dulo de Chamados Relacionados -->
            <div id="moduloRelacionados" class="ia-module hidden">
                <div class="ia-card">
                    <h3>üîó An√°lise de Chamados Relacionados</h3>
                    <p>Encontre chamados similares e identifique padr√µes para resolu√ß√£o mais eficiente.</p>
                    
                    <div class="ia-input-group">
                        <label>Selecionar Chamado:</label>
                        <select id="selectChamadoRelacionado">
                            <option value="">Carregando chamados...</option>
                        </select>
                        <div class="parametros-busca">
                            <label>Score M√≠nimo de Similaridade:</label>
                            <input type="range" id="scoreMinimo" min="0.1" max="1" step="0.1" value="0.3">
                            <span id="scoreValor">0.3</span>
                            
                            <label>Limite de Resultados:</label>
                            <select id="limiteResultados">
                                <option value="5">5</option>
                                <option value="10" selected>10</option>
                                <option value="20">20</option>
                            </select>
                        </div>
                        <button class="btn btn-primary" onclick="buscarRelacionados()">
                            üîç Buscar Relacionados
                        </button>
                    </div>
                    
                    <div id="resultadoRelacionados" class="ia-resultado hidden">
                        <h4>üîó Chamados Similares Encontrados</h4>
                        
                        <div class="chamado-principal">
                            <h5>üìå Chamado Principal:</h5>
                            <div id="chamadoPrincipalInfo"></div>
                        </div>
                        
                        <div class="lista-relacionados">
                            <h5>üìã Chamados Relacionados:</h5>
                            <div id="listaRelacionados"></div>
                        </div>
                        
                        <div class="padroes-identificados">
                            <h5>üîç Padr√µes Identificados:</h5>
                            <div id="padroesLista"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- M√≥dulo de Relat√≥rios de IA -->
            <div id="moduloRelatorios" class="ia-module hidden">
                <div class="ia-card">
                    <h3>üìä Relat√≥rios e Analytics de IA</h3>
                    <p>Visualize m√©tricas e padr√µes identificados pelo sistema inteligente.</p>
                    
                    <div class="ia-input-group">
                        <label>Per√≠odo de An√°lise:</label>
                        <select id="periodoAnalise">
                            <option value="7">√öltimos 7 dias</option>
                            <option value="30" selected>√öltimos 30 dias</option>
                            <option value="90">√öltimos 90 dias</option>
                            <option value="365">√öltimo ano</option>
                        </select>
                        <button class="btn btn-primary" onclick="gerarRelatorioIA()">
                            üìà Gerar Relat√≥rio
                        </button>
                    </div>
                    
                    <div id="resultadoRelatorio" class="ia-resultado hidden">
                        <h4>üìà Analytics Inteligente</h4>
                        
                        <div class="metricas-ia">
                            <div class="metric-card-ia">
                                <div class="metric-value-ia" id="totalChamadosPeriodo">-</div>
                                <div class="metric-label-ia">Total de Chamados</div>
                            </div>
                            <div class="metric-card-ia">
                                <div class="metric-value-ia" id="totalGruposSimilares">-</div>
                                <div class="metric-label-ia">Grupos Similares</div>
                            </div>
                            <div class="metric-card-ia">
                                <div class="metric-value-ia" id="clientesAtivos">-</div>
                                <div class="metric-label-ia">Clientes Ativos</div>
                            </div>
                        </div>
                        
                        <div class="padroes-globais">
                            <h5>üåê Padr√µes Globais Identificados:</h5>
                            <div id="padroesGlobais"></div>
                        </div>
                        
                        <div class="distribuicao-criticidade">
                            <h5>üìä Distribui√ß√£o por Criticidade:</h5>
                            <div id="graficoCriticidade"></div>
                        </div>
                        
                        <div class="clientes-ranking">
                            <h5>üë• Ranking de Clientes:</h5>
                            <div id="rankingClientes"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8000';
        let currentSort = null;
        let sortDirection = 'asc';

        // Carregamento inicial
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üì± DOM carregado, iniciando aplica√ß√£o...');
            
            // Mostrar skeleton loading inicialmente
            mostrarSkeletonDashboard();
            mostrarSkeletonTabela();
            
            // Carregar dados
            console.log('üîÑ Iniciando carregamento de dados...');
            carregarDashboard();
            console.log('üìã Chamando carregarChamados...');
            carregarChamados();
            carregarListaClientes();
            carregarClientesDropdown();
            
            // Aguardar um pouco e inicializar gr√°ficos
            setTimeout(() => {
                console.log('üé® Inicializando gr√°ficos...');
                inicializarTodosGraficos();
            }, 1000);
            
            // Configurar UX e acessibilidade
            melhorarAcessibilidade();
            adicionarNavegacaoTeclado();
            
            // Event listeners para filtros
            document.getElementById('filtroStatus').addEventListener('change', carregarChamados);
            document.getElementById('filtroCriticidade').addEventListener('change', carregarChamados);
            document.getElementById('filtroClienteDropdown').addEventListener('change', carregarChamados);
            document.getElementById('filtroBusca').addEventListener('input', debounce(carregarChamados, 500));
            document.getElementById('filtroDataInicio').addEventListener('change', carregarChamados);
            document.getElementById('filtroDataFim').addEventListener('change', carregarChamados);
            
            // Mostrar toast de boas-vindas
            setTimeout(() => {
                mostrarToast('success', 'Sistema Carregado', 'WEX Intelligence est√° pronto para uso!');
            }, 1000);
        });
        
        // Skeleton Loading para Dashboard
        function mostrarSkeletonDashboard() {
            const metricas = document.getElementById('dashboardMetrics');
            metricas.innerHTML = `
                <div class="metric-card skeleton skeleton-card"></div>
                <div class="metric-card skeleton skeleton-card"></div>
                <div class="metric-card skeleton skeleton-card"></div>
                <div class="metric-card skeleton skeleton-card"></div>
            `;
        }
        
        // Skeleton Loading para Tabela
        function mostrarSkeletonTabela() {
            const tbody = document.getElementById('chamadosTableBody');
            const skeletonRows = Array(5).fill().map(() => `
                <tr>
                    <td><div class="skeleton skeleton-text"></div></td>
                    <td><div class="skeleton skeleton-text"></div></td>
                    <td><div class="skeleton skeleton-text"></div></td>
                    <td><div class="skeleton skeleton-text"></div></td>
                    <td><div class="skeleton skeleton-text"></div></td>
                    <td><div class="skeleton skeleton-text"></div></td>
                    <td><div class="skeleton skeleton-text"></div></td>
                    <td><div class="skeleton skeleton-text"></div></td>
                </tr>
            `).join('');
            
            tbody.innerHTML = skeletonRows;
        }
        
        // Adicionar ARIA labels e melhorar acessibilidade
        function melhorarAcessibilidade() {
            // Adicionar labels para elementos importantes
            const filtroStatus = document.getElementById('filtroStatus');
            if (filtroStatus) {
                filtroStatus.setAttribute('aria-label', 'Filtrar por status do chamado');
            }
            
            const filtroCriticidade = document.getElementById('filtroCriticidade');
            if (filtroCriticidade) {
                filtroCriticidade.setAttribute('aria-label', 'Filtrar por criticidade do chamado');
            }
            
            const filtroBusca = document.getElementById('filtroBusca');
            if (filtroBusca) {
                filtroBusca.setAttribute('aria-label', 'Buscar chamados por texto');
                filtroBusca.setAttribute('placeholder', 'Digite para buscar...');
            }
            
            // Adicionar roles ARIA
            const tabela = document.querySelector('.table');
            if (tabela) {
                tabela.setAttribute('role', 'table');
                tabela.setAttribute('aria-label', 'Lista de chamados');
            }
            
            // Tornar elementos clic√°veis acess√≠veis via teclado
            document.querySelectorAll('.clickable-row').forEach(row => {
                row.setAttribute('tabindex', '0');
                row.setAttribute('role', 'button');
                row.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        this.click();
                    }
                });
            });
        }
        
        // Estados visuais para bot√µes
        function aplicarEstadoBotao(botao, estado, duracao = 2000) {
            const estadosAnteriores = ['loading', 'success', 'error'];
            estadosAnteriores.forEach(est => botao.classList.remove(est));
            
            if (estado !== 'normal') {
                botao.classList.add(estado);
                
                if (estado === 'success' || estado === 'error') {
                    setTimeout(() => {
                        botao.classList.remove(estado);
                    }, duracao);
                }
            }
        }
        
        // Confirma√ß√£o para a√ß√µes importantes
        function confirmarAcao(mensagem, callback) {
            if (confirm(mensagem)) {
                callback();
            }
        }
        
        // Adicionar suporte a navega√ß√£o por teclado
        function adicionarNavegacaoTeclado() {
            document.addEventListener('keydown', function(e) {
                // Esc para fechar modais
                if (e.key === 'Escape') {
                    const modal = document.querySelector('.modal.show');
                    if (modal) {
                        fecharModal();
                    }
                }
                
                // Ctrl+F para focar na busca
                if (e.ctrlKey && e.key === 'f') {
                    e.preventDefault();
                    const busca = document.getElementById('filtroBusca');
                    if (busca) {
                        busca.focus();
                    }
                }
            });
        }
        
        // Busca textual avan√ßada com operadores
        function processarBuscaAvancada(texto, chamados) {
            if (!texto.trim()) return chamados;
            
            const textoLower = texto.toLowerCase();
            let resultados = [];
            
            // Processar operadores AND, OR e aspas
            if (textoLower.includes(' and ')) {
                const termos = textoLower.split(' and ').map(t => t.trim());
                resultados = chamados.filter(chamado => {
                    return termos.every(termo => 
                        buscarEmChamado(chamado, termo)
                    );
                });
            } else if (textoLower.includes(' or ')) {
                const termos = textoLower.split(' or ').map(t => t.trim());
                resultados = chamados.filter(chamado => {
                    return termos.some(termo => 
                        buscarEmChamado(chamado, termo)
                    );
                });
            } else if (texto.startsWith('"') && texto.endsWith('"')) {
                // Busca exata
                const termoExato = texto.slice(1, -1);
                resultados = chamados.filter(chamado => 
                    buscarEmChamado(chamado, termoExato, true)
                );
            } else {
                // Busca simples
                resultados = chamados.filter(chamado => 
                    buscarEmChamado(chamado, textoLower)
                );
            }
            
            return resultados;
        }
        
        // Buscar termo em chamado e follow-ups
        function buscarEmChamado(chamado, termo, exato = false) {
            const textos = [
                chamado.descricao,
                chamado.cliente_solicitante,
                chamado.numero_wex,
                ...(chamado.followups || []).map(f => f.descricao)
            ].join(' ').toLowerCase();
            
            if (exato) {
                return textos.includes(termo.toLowerCase());
            } else {
                return textos.includes(termo);
            }
        }
        
        // Highlight de termos de busca
        function aplicarHighlight(texto, termoBusca) {
            if (!termoBusca.trim()) return texto;
            
            let termos = [];
            const termoBuscaLower = termoBusca.toLowerCase();
            
            // Processar operadores para highlight
            if (termoBuscaLower.includes(' and ')) {
                termos = termoBuscaLower.split(' and ').map(t => t.trim());
            } else if (termoBuscaLower.includes(' or ')) {
                termos = termoBuscaLower.split(' or ').map(t => t.trim());
            } else if (termoBusca.startsWith('"') && termoBusca.endsWith('"')) {
                termos = [termoBusca.slice(1, -1)];
            } else {
                termos = [termoBuscaLower];
            }
            
            let textoHighlight = texto;
            termos.forEach(termo => {
                if (termo.trim()) {
                    const regex = new RegExp(`(${termo.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')})`, 'gi');
                    textoHighlight = textoHighlight.replace(regex, '<span class="highlight">$1</span>');
                }
            });
            
            return textoHighlight;
        }
        
        // Fun√ß√£o debounce para busca
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // Fun√ß√£o para abrir modal de detalhes aprimorado
        async function abrirModalDetalhes(id) {
            try {
                console.log('üîç Carregando detalhes do chamado ID:', id);
                
                const response = await fetch(`${API_BASE}/chamados/${id}`);
                console.log('üì• Resposta da API:', response.status, response.statusText);
                
                if (!response.ok) {
                    throw new Error(`Erro HTTP: ${response.status} - ${response.statusText}`);
                }
                
                const chamado = await response.json();
                console.log('üìã Dados do chamado:', chamado);
                
                const followupsResponse = await fetch(`${API_BASE}/chamados/${id}/followups`);
                console.log('üì• Resposta follow-ups:', followupsResponse.status);
                
                const followups = followupsResponse.ok ? await followupsResponse.json() : [];
                console.log('üìù Follow-ups:', followups);
                
                const score = parseInt(chamado.score_qualidade) || 0;
                const scoreClass = score >= 80 ? 'score-alto' : score >= 60 ? 'score-medio' : 'score-baixo';
                
                const modal = document.getElementById('chamadoModal');
                if (!modal) {
                    throw new Error('Modal n√£o encontrado no DOM');
                }
                modal.innerHTML = `
                    <div class="modal-content modal-content-enhanced">
                        <div class="modal-header-enhanced">
                            <div>
                                <h2 class="modal-title-enhanced">Chamado ${chamado.numero_wex}</h2>
                                <small style="opacity: 0.8;">${chamado.cliente_solicitante}</small>
                            </div>
                            <div class="chamado-score-display">
                                <div class="score-circle ${scoreClass}">
                                    <span class="score-text">${score}%</span>
                                </div>
                                <button class="close" onclick="fecharModal()">&times;</button>
                            </div>
                        </div>
                        
                        <div class="modal-body-enhanced">
                            <div class="chamado-info-grid">
                                <div class="info-principais">
                                    <h3 style="margin-top: 0; color: #495057;">Descri√ß√£o do Chamado</h3>
                                    <p style="line-height: 1.6; color: #6c757d;">${chamado.descricao}</p>
                                    
                                    <div class="timeline-vertical">
                                        <h4 style="color: #495057; margin-bottom: 15px;">üìã Hist√≥rico de Follow-ups</h4>
                                        ${followups.map(followup => `
                                            <div class="timeline-item-enhanced tipo-${followup.tipo.toLowerCase()}">
                                                <div class="timeline-header-enhanced">
                                                    <span class="timeline-tipo-enhanced">${followup.tipo}</span>
                                                    <span class="timeline-data-enhanced">${formatarData(followup.data_criacao)}</span>
                                                </div>
                                                <div class="timeline-conteudo-enhanced">${followup.descricao}</div>
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>
                                
                                <div class="info-lateral">
                                    <div class="info-card">
                                        <h4>üìä Status & Criticidade</h4>
                                        <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                                            <span class="status-badge status-${chamado.status.toLowerCase().replace(' ', '-')}">${chamado.status}</span>
                                            <span class="criticidade-badge criticidade-${chamado.criticidade.toLowerCase()}">${chamado.criticidade}</span>
                                        </div>
                                    </div>
                                    
                                    <div class="info-card">
                                        <h4>üìÖ Datas Importantes</h4>
                                        <div style="font-size: 0.9rem; line-height: 1.5;">
                                            <div><strong>Abertura:</strong><br>${formatarData(chamado.data_criacao)}</div>
                                            <div style="margin-top: 8px;"><strong>√öltima Atualiza√ß√£o:</strong><br>${formatarData(chamado.data_ultima_atualizacao || chamado.data_criacao)}</div>
                                        </div>
                                    </div>
                                    
                                    <div class="info-card">
                                        <h4>üéØ M√©tricas de Qualidade</h4>
                                        <div style="text-align: center;">
                                            <div style="font-size: 2rem; font-weight: bold; color: ${score >= 8 ? '#28a745' : score >= 6 ? '#ffc107' : '#dc3545'};">
                                                ${score}%
                                            </div>
                                            <div style="font-size: 0.8rem; color: #6c757d; margin-top: 5px;">
                                                Score de Qualidade
                                            </div>
                                            <div style="margin-top: 10px; font-size: 0.9rem;">
                                                <div>‚úÖ Ambiente: ${chamado.ambiente_informado ? 'Informado' : 'N√£o informado'}</div>
                                                <div>üìé Anexos: ${chamado.possui_anexos ? 'Presentes' : 'Ausentes'}</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="anexos-section">
                            <h4>üìé Anexos do Chamado</h4>
                            <div class="anexos-grid" id="anexos-${chamado.id}">
                                ${renderizarAnexos(gerarAnexosSimulados())}
                            </div>
                        </div>
                        
                        <div class="modal-actions">
                            <div>
                                <button class="btn-action btn-primary-action" onclick="editarChamado(${chamado.id})">
                                    ‚úèÔ∏è Editar Chamado
                                </button>
                                <button class="btn-action btn-success-action" onclick="adicionarFollowup(${chamado.id})">
                                    ‚ûï Adicionar Follow-up
                                </button>
                            </div>
                            <button class="btn-action btn-secondary-action" onclick="fecharModal()">
                                ‚ùå Fechar
                            </button>
                        </div>
                    </div>
                `;
                
                modal.style.display = 'flex';
                modal.classList.add('show');
                console.log('‚úÖ Modal de detalhes carregado com sucesso');
                
            } catch (error) {
                console.error('‚ùå Erro ao carregar detalhes:', error);
                
                // Mostrar erro mais espec√≠fico
                let mensagemErro = 'N√£o foi poss√≠vel carregar os detalhes do chamado.';
                if (error.message.includes('404')) {
                    mensagemErro = 'Chamado n√£o encontrado.';
                } else if (error.message.includes('500')) {
                    mensagemErro = 'Erro interno do servidor.';
                } else if (error.message.includes('Erro HTTP')) {
                    mensagemErro = error.message;
                }
                
                mostrarToast('error', 'Erro', mensagemErro);
                
                // Tentar mostrar modal com informa√ß√µes b√°sicas se dispon√≠vel
                const modal = document.getElementById('chamadoModal');
                if (modal) {
                    modal.innerHTML = `
                        <div class="modal-content">
                            <div class="modal-header">
                                <h2>Erro ao Carregar Detalhes</h2>
                                <button class="close" onclick="fecharModal()">&times;</button>
                            </div>
                            <div class="modal-body">
                                <p>‚ùå ${mensagemErro}</p>
                                <p>ID do chamado: ${id}</p>
                                <p>Tente novamente ou verifique se o chamado existe.</p>
                            </div>
                            <div class="modal-actions">
                                <button class="btn-action btn-secondary-action" onclick="fecharModal()">Fechar</button>
                            </div>
                        </div>
                    `;
                    modal.style.display = 'flex';
                }
            }
        }
        
        // Fun√ß√£o para fechar modal
        function fecharModal() {
            const modal = document.getElementById('chamadoModal');
            if (modal) {
                modal.style.display = 'none';
                modal.classList.remove('show');
                console.log('‚úÖ Modal fechado com sucesso');
            } else {
                console.error('‚ùå Modal n√£o encontrado para fechar');
            }
        }
        
        // Fechar modal com ESC ou clique fora
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                const modal = document.getElementById('chamadoModal');
                if (modal && modal.style.display === 'flex') {
                    fecharModal();
                }
            }
        });
        
        // Fechar modal clicando no overlay (fundo)
        document.addEventListener('click', function(event) {
            const modal = document.getElementById('chamadoModal');
            if (event.target === modal) {
                fecharModal();
            }
        });
        
        // Fun√ß√µes auxiliares para a√ß√µes do modal
        function editarChamado(id) {
            mostrarToast('info', 'Funcionalidade em Desenvolvimento', `Editar chamado ${id} ser√° implementado no Dia 3.`);
        }
        
        function adicionarFollowup(id) {
            mostrarToast('info', 'Funcionalidade em Desenvolvimento', `Adicionar follow-up ao chamado ${id} ser√° implementado no Dia 3.`);
        }

        // Vari√°veis globais para os gr√°ficos
        let statusChart, criticidadeChart, volumeChart, tendenciaChart;

        // Fun√ß√£o auxiliar para destruir charts de forma segura
        function destruirChartSeguro(chart, nomeChart) {
            if (chart) {
                try {
                    chart.destroy();
                    console.log(`üóëÔ∏è Chart ${nomeChart} destru√≠do com sucesso`);
                } catch (error) {
                    console.warn(`‚ö†Ô∏è Erro ao destruir chart ${nomeChart}:`, error);
                }
            }
        }

        // Fun√ß√£o para destruir todos os charts
        function destruirTodosCharts() {
            destruirChartSeguro(statusChart, 'status');
            destruirChartSeguro(criticidadeChart, 'criticidade');
            destruirChartSeguro(volumeChart, 'volume');
            destruirChartSeguro(tendenciaChart, 'tendencia');
            statusChart = null;
            criticidadeChart = null;
            volumeChart = null;
            tendenciaChart = null;
        }

        // Fun√ß√£o simplificada para inicializar todos os gr√°ficos
        async function inicializarTodosGraficos() {
            console.log('üöÄ Inicializando todos os gr√°ficos...');
            
            try {
                // Verificar se Chart.js est√° dispon√≠vel
                if (typeof Chart === 'undefined') {
                    console.error('‚ùå Chart.js n√£o est√° dispon√≠vel');
                    return;
                }
                
                // Buscar dados das m√©tricas
                const responseMetricas = await fetch(`${API_BASE}/dashboard/metricas`);
                const dadosMetricas = await responseMetricas.json();
                console.log('üìä Dados das m√©tricas:', dadosMetricas);
                
                // Criar gr√°fico de status
                if (dadosMetricas.total_chamados_por_status) {
                    console.log('üìà Criando gr√°fico de status...');
                    criarGraficoStatusSimplificado(dadosMetricas.total_chamados_por_status);
                }
                
                // Criar gr√°fico de criticidade
                if (dadosMetricas.distribuicao_por_criticidade) {
                    console.log('üî• Criando gr√°fico de criticidade...');
                    criarGraficoCriticidadeSimplificado(dadosMetricas.distribuicao_por_criticidade);
                }
                
                // Criar gr√°fico de volume
                console.log('üìÖ Criando gr√°fico de volume...');
                await criarGraficoVolumeSimplificado();
                
                // Criar gr√°fico de tend√™ncia
                console.log('‚è±Ô∏è Criando gr√°fico de tend√™ncia...');
                criarGraficoTendenciaSimplificado();
                
                console.log('‚úÖ Todos os gr√°ficos foram inicializados!');
                
            } catch (error) {
                console.error('‚ùå Erro ao inicializar gr√°ficos:', error);
            }
        }
        
        // Fun√ß√µes simplificadas para criar gr√°ficos
        function criarGraficoStatusSimplificado(dados) {
            const canvas = document.getElementById('statusChart');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            
            if (window.statusChart && typeof window.statusChart.destroy === 'function') {
                window.statusChart.destroy();
            }
            
            window.statusChart = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: Object.keys(dados),
                    datasets: [{
                        data: Object.values(dados),
                        backgroundColor: ['#3498db', '#f39c12', '#e74c3c', '#2ecc71', '#95a5a6']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false
                }
            });
        }
        
        function criarGraficoCriticidadeSimplificado(dados) {
            const canvas = document.getElementById('criticidadeChart');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            
            if (window.criticidadeChart && typeof window.criticidadeChart.destroy === 'function') {
                window.criticidadeChart.destroy();
            }
            
            window.criticidadeChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(dados),
                    datasets: [{
                        data: Object.values(dados),
                        backgroundColor: ['#2ecc71', '#f39c12', '#e67e22', '#e74c3c']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false
                }
            });
        }
        
        async function criarGraficoVolumeSimplificado() {
            const canvas = document.getElementById('volumeChart');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            
            if (window.volumeChart && typeof window.volumeChart.destroy === 'function') {
                window.volumeChart.destroy();
            }
            
            // Dados simulados para os √∫ltimos 7 dias
            const labels = ['01/10', '02/10', '03/10', '04/10', '05/10', '06/10', '07/10'];
            const data = [8, 12, 6, 15, 10, 9, 14];
            
            window.volumeChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Chamados Criados',
                        data: data,
                        backgroundColor: '#3498db'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }
        
        function criarGraficoTendenciaSimplificado() {
            const canvas = document.getElementById('tendenciaChart');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            
            if (window.tendenciaChart && typeof window.tendenciaChart.destroy === 'function') {
                window.tendenciaChart.destroy();
            }
            
            window.tendenciaChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['Sem -3', 'Sem -2', 'Sem -1', 'Atual'],
                    datasets: [{
                        label: 'Tempo M√©dio (horas)',
                        data: [48, 52, 45, 38],
                        borderColor: '#2ecc71',
                        backgroundColor: 'rgba(46, 204, 113, 0.1)',
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        async function carregarDashboard() {
            try {
                console.log('Carregando dashboard...', API_BASE);
                
                // Primeiro, restaurar o HTML correto dos cards (caso tenha sido sobrescrito pelo skeleton)
                const metricas = document.getElementById('dashboardMetrics');
                metricas.innerHTML = `
                    <div class="metric-card total">
                        <div class="metric-value" id="totalChamados">-</div>
                        <div class="metric-label">Total de Chamados</div>
                    </div>
                    <div class="metric-card critical">
                        <div class="metric-value" id="chamadosCriticos">-</div>
                        <div class="metric-label">Chamados Cr√≠ticos</div>
                    </div>
                    <div class="metric-card resolved">
                        <div class="metric-value" id="chamadosHoje">-</div>
                        <div class="metric-label">Novos Hoje</div>
                    </div>
                    <div class="metric-card average">
                        <div class="metric-value" id="tempoMedio">-</div>
                        <div class="metric-label">Tempo M√©dio (horas)</div>
                    </div>
                `;
                
                const response = await fetch(`${API_BASE}/dashboard/metricas`);
                const data = await response.json();
                console.log('Dados do dashboard recebidos:', data);
                
                // Calcular total de chamados
                const totalChamados = Object.values(data.total_chamados_por_status || {}).reduce((a, b) => a + b, 0);
                console.log('Total de chamados calculado:', totalChamados);
                
                const elementoTotal = document.getElementById('totalChamados');
                const elementoCriticos = document.getElementById('chamadosCriticos');
                const elementoHoje = document.getElementById('chamadosHoje');
                const elementoTempo = document.getElementById('tempoMedio');
                
                console.log('Elementos encontrados:', {
                    totalChamados: elementoTotal,
                    chamadosCriticos: elementoCriticos,
                    chamadosHoje: elementoHoje,
                    tempoMedio: elementoTempo
                });
                
                if (elementoTotal) elementoTotal.textContent = totalChamados;
                if (elementoCriticos) elementoCriticos.textContent = data.chamados_criticos_abertos || 0;
                if (elementoHoje) elementoHoje.textContent = data.chamados_novos_hoje || 0;
                
                const tempoMedio = data.tempo_medio_resolucao;
                if (elementoTempo) elementoTempo.textContent = tempoMedio 
                    ? tempoMedio.toFixed(1) 
                    : 'N/A';
                    
            } catch (error) {
                console.error('Erro ao carregar dashboard:', error);
            }
        }

        async function carregarDashboardAvancado() {
            try {
                console.log('Carregando dashboard avan√ßado...');
                
                // Destruir charts existentes antes de criar novos
                destruirTodosCharts();
                console.log('üóëÔ∏è Charts anteriores destru√≠dos');
                
                const response = await fetch(`${API_BASE}/dashboard/metricas`);
                const data = await response.json();
                console.log('Dados do dashboard avan√ßado:', data);
                
                // Carregar notifica√ß√µes reais
                await carregarNotificacoesReais();
                
                // Atualizar indicadores de SLA
                await carregarIndicadoresSLA();
                
                // Criar gr√°ficos
                console.log('Criando gr√°ficos...');
                criarGraficoStatus(data.total_chamados_por_status || {});
                criarGraficoCriticidade(data.distribuicao_por_criticidade || {});
                await criarGraficoVolume();
                await criarGraficoTendencia();
                console.log('Gr√°ficos criados com sucesso');
                
            } catch (error) {
                console.error('Erro ao carregar dashboard avan√ßado:', error);
            }
        }

        async function carregarIndicadoresSLA() {
            try {
                console.log('üéØ Carregando indicadores SLA...');
                // Buscar todos os chamados para calcular SLA
                const response = await fetch(`${API_BASE}/chamados?limit=100`);
                const data = await response.json();
                console.log('üìä Dados recebidos para SLA:', data);
                
                const agora = new Date();
                let slaOk = 0, slaWarning = 0, slaExpired = 0;
                
                // SLA por criticidade (em horas)
                const slaHoras = {
                    'Cr√≠tica': 4,
                    'Alta': 8,
                    'M√©dia': 24,
                    'Baixa': 48
                };
                
                data.chamados.forEach(chamado => {
                    // Pular chamados j√° resolvidos/fechados
                    if (['Resolvido', 'Fechado'].includes(chamado.status)) return;
                    
                    let slaLimite;
                    
                    // Usar sla_limite se dispon√≠vel, sen√£o calcular baseado na criticidade
                    if (chamado.sla_limite) {
                        slaLimite = new Date(chamado.sla_limite);
                    } else {
                        const dataCriacao = new Date(chamado.data_criacao);
                        const horasLimite = slaHoras[chamado.criticidade] || 24;
                        slaLimite = new Date(dataCriacao.getTime() + horasLimite * 60 * 60 * 1000);
                    }
                    
                    const diffHoras = (slaLimite - agora) / (1000 * 60 * 60);
                    
                    if (diffHoras < 0) {
                        slaExpired++;
                    } else if (diffHoras < 4) { // Pr√≥ximo ao vencimento (menos de 4 horas)
                        slaWarning++;
                    } else {
                        slaOk++;
                    }
                });
                
                console.log('üìà Contadores SLA calculados:', { slaOk, slaWarning, slaExpired });
                
                const elemSlaOk = document.getElementById('slaOk');
                const elemSlaWarning = document.getElementById('slaWarning');
                const elemSlaExpired = document.getElementById('slaExpired');
                
                console.log('üîç Elementos SLA encontrados:', {
                    slaOk: elemSlaOk,
                    slaWarning: elemSlaWarning,
                    slaExpired: elemSlaExpired
                });
                
                if (elemSlaOk) elemSlaOk.textContent = slaOk;
                if (elemSlaWarning) elemSlaWarning.textContent = slaWarning;
                if (elemSlaExpired) elemSlaExpired.textContent = slaExpired;
                
                console.log('‚úÖ Indicadores SLA atualizados com sucesso');
                
            } catch (error) {
                console.error('‚ùå Erro ao carregar indicadores SLA:', error);
            }
        }

        function criarGraficoStatus(dados) {
            console.log('üéØ Criando gr√°fico de status com dados:', dados);
            const ctx = document.getElementById('statusChart');
            
            if (!ctx) {
                console.error('‚ùå Elemento statusChart n√£o encontrado!');
                return;
            }
            
            console.log('‚úÖ Canvas statusChart encontrado:', ctx);
            
            // Destruir chart anterior de forma segura
            destruirChartSeguro(statusChart, 'status');
            statusChart = null;
            
            const labels = Object.keys(dados);
            const values = Object.values(dados);
            console.log('üìä Labels:', labels);
            console.log('üìä Values:', values);
            
            if (labels.length === 0 || values.length === 0) {
                console.error('‚ùå Dados vazios para o gr√°fico de status');
                return;
            }
            
            const colors = ['#3498db', '#f39c12', '#e74c3c', '#2ecc71', '#95a5a6'];
            
            try {
                statusChart = new Chart(ctx.getContext('2d'), {
                    type: 'pie',
                    data: {
                        labels: labels,
                        datasets: [{
                            data: values,
                            backgroundColor: colors.slice(0, labels.length),
                            borderWidth: 2,
                            borderColor: '#fff'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    padding: 20,
                                    font: {
                                        size: 12
                                    }
                                }
                            }
                        }
                    }
                });
                console.log('‚úÖ Gr√°fico de status criado com sucesso:', statusChart);
            } catch (error) {
                console.error('‚ùå Erro ao criar gr√°fico de status:', error);
            }
        }

        function criarGraficoCriticidade(dados) {
            console.log('üéØ Criando gr√°fico de criticidade com dados:', dados);
            const ctx = document.getElementById('criticidadeChart');
            
            if (!ctx) {
                console.error('‚ùå Elemento criticidadeChart n√£o encontrado!');
                return;
            }
            
            console.log('‚úÖ Canvas criticidadeChart encontrado:', ctx);
            
            // Destruir chart anterior de forma segura
            destruirChartSeguro(criticidadeChart, 'criticidade');
            criticidadeChart = null;
            
            const labels = Object.keys(dados);
            const values = Object.values(dados);
            console.log('üìä Labels:', labels);
            console.log('üìä Values:', values);
            
            if (labels.length === 0 || values.length === 0) {
                console.error('‚ùå Dados vazios para o gr√°fico de criticidade');
                return;
            }
            
            const colors = ['#2ecc71', '#f39c12', '#e67e22', '#e74c3c'];
            
            try {
                criticidadeChart = new Chart(ctx.getContext('2d'), {
                    type: 'doughnut',
                    data: {
                        labels: labels,
                        datasets: [{
                            data: values,
                            backgroundColor: colors.slice(0, labels.length),
                            borderWidth: 2,
                            borderColor: '#fff'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    padding: 20,
                                    font: {
                                        size: 12
                                    }
                                }
                            }
                        }
                    }
                });
                console.log('‚úÖ Gr√°fico de criticidade criado com sucesso:', criticidadeChart);
            } catch (error) {
                console.error('‚ùå Erro ao criar gr√°fico de criticidade:', error);
            }
        }

        async function criarGraficoVolume() {
            try {
                console.log('üéØ Criando gr√°fico de volume...');
                const response = await fetch(`${API_BASE}/chamados?limit=100`);
                const data = await response.json();
                console.log('üìä Dados recebidos para volume:', data);
                
                // Agrupar por dia dos √∫ltimos 7 dias
                const ultimosDias = [];
                const contagemPorDia = {};
                
                for (let i = 6; i >= 0; i--) {
                    const data = new Date();
                    data.setDate(data.getDate() - i);
                    const dataStr = data.toISOString().split('T')[0];
                    ultimosDias.push(dataStr);
                    contagemPorDia[dataStr] = 0;
                }
                
                console.log('üìÖ √öltimos dias:', ultimosDias);
                
                data.chamados.forEach(chamado => {
                    const dataCriacao = chamado.data_criacao.split('T')[0];
                    if (contagemPorDia.hasOwnProperty(dataCriacao)) {
                        contagemPorDia[dataCriacao]++;
                    }
                });
                
                console.log('üìä Contagem por dia:', contagemPorDia);
                
                const ctx = document.getElementById('volumeChart');
                
                if (!ctx) {
                    console.error('‚ùå Elemento volumeChart n√£o encontrado!');
                    return;
                }
                
                // Destruir chart anterior de forma segura
                destruirChartSeguro(volumeChart, 'volume');
                volumeChart = null;
                
                volumeChart = new Chart(ctx.getContext('2d'), {
                    type: 'bar',
                    data: {
                        labels: ultimosDias.map(data => new Date(data).toLocaleDateString('pt-BR', { month: 'short', day: 'numeric' })),
                        datasets: [{
                            label: 'Chamados Criados',
                            data: ultimosDias.map(data => contagemPorDia[data]),
                            backgroundColor: '#3498db',
                            borderColor: '#2980b9',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    stepSize: 1
                                }
                            }
                        }
                    }
                });
                
                console.log('‚úÖ Gr√°fico de volume criado com sucesso:', volumeChart);
                
            } catch (error) {
                console.error('‚ùå Erro ao criar gr√°fico de volume:', error);
            }
        }

        async function criarGraficoTendencia() {
            try {
                console.log('üéØ Criando gr√°fico de tend√™ncia...');
                const response = await fetch(`${API_BASE}/chamados?limit=100`);
                const data = await response.json();
                console.log('üìä Dados recebidos para tend√™ncia:', data);
                
                // Simular dados de tend√™ncia (tempo m√©dio de resolu√ß√£o por semana)
                const semanas = ['Sem -3', 'Sem -2', 'Sem -1', 'Atual'];
                const temposMedias = [48, 52, 45, 38]; // Horas fict√≠cias mostrando melhoria
                
                console.log('üìä Dados de tend√™ncia:', { semanas, temposMedias });
                
                const ctx = document.getElementById('tendenciaChart');
                
                if (!ctx) {
                    console.error('‚ùå Elemento tendenciaChart n√£o encontrado!');
                    return;
                }
                
                // Destruir chart anterior de forma segura
                destruirChartSeguro(tendenciaChart, 'tendencia');
                tendenciaChart = null;
                
                tendenciaChart = new Chart(ctx.getContext('2d'), {
                    type: 'line',
                    data: {
                        labels: semanas,
                        datasets: [{
                            label: 'Tempo M√©dio (horas)',
                            data: temposMedias,
                            borderColor: '#2ecc71',
                            backgroundColor: 'rgba(46, 204, 113, 0.1)',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Horas'
                                }
                            }
                        }
                    }
                });
                
                console.log('‚úÖ Gr√°fico de tend√™ncia criado com sucesso:', tendenciaChart);
                
            } catch (error) {
                console.error('‚ùå Erro ao criar gr√°fico de tend√™ncia:', error);
            }
        }

        async function carregarListaClientes() {
            try {
                const response = await fetch(`${API_BASE}/chamados?limit=100`);
                const data = await response.json();
                
                // Extrair lista √∫nica de clientes
                const clientes = [...new Set(data.chamados.map(c => c.cliente_solicitante))].sort();
                
                const select = document.getElementById('filtroClienteDropdown');
                select.innerHTML = '<option value="">Todos os clientes</option>';
                
                clientes.forEach(cliente => {
                    const option = document.createElement('option');
                    option.value = cliente;
                    option.textContent = cliente;
                    select.appendChild(option);
                });
                
            } catch (error) {
                console.error('Erro ao carregar lista de clientes:', error);
            }
        }

        function limparFiltros() {
            document.getElementById('filtroStatus').selectedIndex = -1;
            document.getElementById('filtroCriticidade').selectedIndex = -1;
            document.getElementById('filtroClienteDropdown').selectedIndex = 0;
            document.getElementById('filtroDataInicio').value = '';
            document.getElementById('filtroDataFim').value = '';
            document.getElementById('filtroBusca').value = '';
            
            paginaAtual = 1;
            carregarChamados();
        }

        function ordenarPor(campo) {
            if (currentSort === campo) {
                sortDirection = sortDirection === 'asc' ? 'desc' : 'asc';
            } else {
                currentSort = campo;
                sortDirection = 'asc';
            }
            carregarChamados();
        }

        async function abrirDetalhes(chamadoId) {
            try {
                // Buscar detalhes do chamado
                const response = await fetch(`${API_BASE}/chamados/${chamadoId}`);
                const chamado = await response.json();
                
                // Buscar follow-ups
                const followupsResponse = await fetch(`${API_BASE}/chamados/${chamadoId}/followups`);
                const followups = await followupsResponse.json();
                
                // Preencher modal
                document.getElementById('modalTitulo').textContent = `Chamado ${chamado.numero_wex}`;
                
                const detailsContainer = document.getElementById('chamadoDetails');
                detailsContainer.innerHTML = `
                    <div class="detail-item">
                        <div class="detail-label">N√∫mero WEX</div>
                        <div class="detail-value">${chamado.numero_wex}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Cliente</div>
                        <div class="detail-value">${chamado.cliente_solicitante}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Status</div>
                        <div class="detail-value">
                            <span class="status-badge status-${chamado.status.toLowerCase().replace(' ', '-')}">${chamado.status}</span>
                        </div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Criticidade</div>
                        <div class="detail-value">
                            <span class="criticidade-badge criticidade-${chamado.criticidade.toLowerCase()}">${chamado.criticidade}</span>
                        </div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Data de Cria√ß√£o</div>
                        <div class="detail-value">${formatarData(chamado.data_criacao)}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Score de Qualidade</div>
                        <div class="detail-value">${chamado.score_qualidade}%</div>
                    </div>
                    <div class="detail-item" style="grid-column: 1/-1;">
                        <div class="detail-label">Descri√ß√£o</div>
                        <div class="detail-value">${chamado.descricao}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Ambiente Informado</div>
                        <div class="detail-value">${chamado.ambiente_informado ? '‚úÖ Sim' : '‚ùå N√£o'}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Possui Anexos</div>
                        <div class="detail-value">${chamado.possui_anexos ? 'üìé Sim' : '‚ùå N√£o'}</div>
                    </div>
                `;
                
                // Preencher timeline de follow-ups
                const timelineContainer = document.getElementById('followupTimeline');
                if (followups.length > 0) {
                    timelineContainer.innerHTML = followups.map(followup => `
                        <div class="followup-item">
                            <div class="followup-header">
                                <span class="followup-autor">${followup.autor}</span>
                                <span class="followup-tipo">${followup.tipo}</span>
                            </div>
                            <div class="followup-data">${formatarData(followup.data_criacao)}</div>
                            <div class="followup-descricao">${followup.descricao}</div>
                        </div>
                    `).join('');
                } else {
                    timelineContainer.innerHTML = '<p style="text-align: center; color: #666;">Nenhum follow-up encontrado</p>';
                }
                
                // Mostrar modal
                document.getElementById('chamadoModal').style.display = 'flex';
                
            } catch (error) {
                console.error('Erro ao carregar detalhes do chamado:', error);
                alert('Erro ao carregar detalhes do chamado');
            }
        }
        
        // Fun√ß√µes para Anexos Simulados
        function gerarAnexosSimulados() {
            const tipos = [
                { nome: 'Contrato.pdf', tipo: 'pdf', icone: 'üìÑ', tamanho: '2.4 MB' },
                { nome: 'Nota_Fiscal.pdf', tipo: 'pdf', icone: 'üìÑ', tamanho: '1.2 MB' },
                { nome: 'Foto_Produto.jpg', tipo: 'imagem', icone: 'üñºÔ∏è', tamanho: '856 KB' },
                { nome: 'Planilha_Dados.xlsx', tipo: 'excel', icone: 'üìä', tamanho: '3.1 MB' },
                { nome: 'Apresentacao.pptx', tipo: 'powerpoint', icone: 'üìë', tamanho: '5.7 MB' },
                { nome: 'Documento.docx', tipo: 'word', icone: 'üìù', tamanho: '1.8 MB' }
            ];
            
            return tipos.slice(0, Math.floor(Math.random() * 4) + 2);
        }
        
        function renderizarAnexos(anexos) {
            return anexos.map(anexo => `
                <div class="anexo-item" onclick="visualizarAnexo('${anexo.nome}', '${anexo.tipo}')">
                    <div class="anexo-icon">${anexo.icone}</div>
                    <div class="anexo-nome">${anexo.nome}</div>
                    <div class="anexo-tamanho">${anexo.tamanho}</div>
                </div>
            `).join('');
        }
        
        function visualizarAnexo(nome, tipo) {
            if (tipo === 'imagem') {
                mostrarPreviewImagem(nome);
            } else {
                simularDownload(nome);
            }
        }
        
        function mostrarPreviewImagem(nome) {
            const modalPreview = document.createElement('div');
            modalPreview.className = 'image-preview-modal';
            modalPreview.innerHTML = `
                <div class="image-preview-content">
                    <button class="image-preview-close" onclick="this.parentElement.parentElement.remove()">&times;</button>
                    <img src="data:image/svg+xml;base64,${gerarImagemSimulada()}" alt="${nome}">
                </div>
            `;
            
            document.body.appendChild(modalPreview);
            
            modalPreview.addEventListener('click', function(e) {
                if (e.target === modalPreview) {
                    modalPreview.remove();
                }
            });
        }
        
        function gerarImagemSimulada() {
            const svg = `
                <svg width="400" height="300" xmlns="http://www.w3.org/2000/svg">
                    <rect width="100%" height="100%" fill="#e9ecef"/>
                    <circle cx="200" cy="150" r="50" fill="#6c757d"/>
                    <text x="200" y="220" text-anchor="middle" fill="#495057" font-family="Arial" font-size="16">Imagem Simulada</text>
                </svg>
            `;
            return btoa(svg);
        }
        
        function simularDownload(nome) {
            mostrarToast(`Download iniciado: ${nome}`, 'info');
            
            setTimeout(() => {
                mostrarToast(`Download conclu√≠do: ${nome}`, 'success');
            }, 2000);
        }
        
        // Vari√°veis de Pagina√ß√£o
        let paginaAtual = 1;
        let tamanhoPagina = 20;
        let totalChamados = 0;
        let totalPaginas = 0;
        
        // Fun√ß√µes de Pagina√ß√£o Avan√ßada
        function mudarTamanhoPagina() {
            tamanhoPagina = parseInt(document.getElementById('pageSize').value);
            paginaAtual = 1;
            carregarChamados();
        }
        
        function irParaPagina(pagina) {
            paginaAtual = pagina;
            carregarChamados();
        }
        
        function paginaAnterior() {
            if (paginaAtual > 1) {
                paginaAtual--;
                carregarChamados();
            }
        }
        
        function proximaPagina() {
            if (paginaAtual < totalPaginas) {
                paginaAtual++;
                carregarChamados();
            }
        }
        
        function irParaUltimaPagina() {
            paginaAtual = totalPaginas;
            carregarChamados();
        }
        
        function atualizarPaginacao(total, chamados) {
            totalChamados = total;
            totalPaginas = Math.ceil(total / tamanhoPagina);
            
            // Atualizar estat√≠sticas
            const inicio = (paginaAtual - 1) * tamanhoPagina + 1;
            const fim = Math.min(paginaAtual * tamanhoPagina, total);
            document.getElementById('paginationStats').textContent = 
                `Mostrando ${inicio}-${fim} de ${total} resultados`;
            
            // Atualizar bot√µes de navega√ß√£o
            document.getElementById('btnPrimeira').disabled = paginaAtual <= 1;
            document.getElementById('btnAnterior').disabled = paginaAtual <= 1;
            document.getElementById('btnProxima').disabled = paginaAtual >= totalPaginas;
            document.getElementById('btnUltima').disabled = paginaAtual >= totalPaginas;
            
            // Gerar n√∫meros de p√°gina
            gerarNumerosPagina();
        }
        
        function gerarNumerosPagina() {
            const container = document.getElementById('paginasNumeros');
            let html = '';
            
            const maxPaginas = 5;
            let inicio = Math.max(1, paginaAtual - Math.floor(maxPaginas / 2));
            let fim = Math.min(totalPaginas, inicio + maxPaginas - 1);
            
            if (fim - inicio < maxPaginas - 1) {
                inicio = Math.max(1, fim - maxPaginas + 1);
            }
            
            if (inicio > 1) {
                html += `<button class="pagination-btn" onclick="irParaPagina(1)">1</button>`;
                if (inicio > 2) {
                    html += `<span>...</span>`;
                }
            }
            
            for (let i = inicio; i <= fim; i++) {
                const ativo = i === paginaAtual ? 'active' : '';
                html += `<button class="pagination-btn ${ativo}" onclick="irParaPagina(${i})">${i}</button>`;
            }
            
            if (fim < totalPaginas) {
                if (fim < totalPaginas - 1) {
                    html += `<span>...</span>`;
                }
                html += `<button class="pagination-btn" onclick="irParaPagina(${totalPaginas})">${totalPaginas}</button>`;
            }
            
            container.innerHTML = html;
        }

        // Fechar modal ao clicar fora dele
        window.onclick = function(event) {
            const modal = document.getElementById('chamadoModal');
            if (event.target === modal) {
                fecharModal();
            }
        }

        async function carregarChamados() {
            try {
                console.log('üîç Iniciando carregamento de chamados...');
                const params = new URLSearchParams();
                params.append('skip', (paginaAtual - 1) * tamanhoPagina);
                params.append('limit', tamanhoPagina);
                
                console.log('üìÑ Par√¢metros de pagina√ß√£o:', { paginaAtual, tamanhoPagina });
                
                // Filtros b√°sicos
                const status = Array.from(document.getElementById('filtroStatus').selectedOptions).map(opt => opt.value);
                const criticidade = Array.from(document.getElementById('filtroCriticidade').selectedOptions).map(opt => opt.value);
                const clienteDropdown = document.getElementById('filtroClienteDropdown').value;
                const busca = document.getElementById('filtroBusca').value.trim();
                
                // Filtros de data
                const dataInicio = document.getElementById('filtroDataInicio').value;
                const dataFim = document.getElementById('filtroDataFim').value;
                
                status.forEach(s => params.append('status', s));
                criticidade.forEach(c => params.append('criticidade', c));
                if (clienteDropdown) params.append('cliente', clienteDropdown);
                if (busca) params.append('busca_texto', busca);
                if (dataInicio) params.append('data_inicio', dataInicio);
                if (dataFim) params.append('data_fim', dataFim);
                
                const url = `${API_BASE}/chamados?${params}`;
                console.log('üåê URL da requisi√ß√£o:', url);
                
                const response = await fetch(url);
                console.log('üì° Status da resposta:', response.status);
                
                const data = await response.json();
                console.log('üìä Dados recebidos:', data);
                
                // Aplicar ordena√ß√£o no frontend se necess√°rio
                let chamados = data.chamados;
                console.log('üìã N√∫mero de chamados recebidos:', chamados?.length || 0);
                
                if (currentSort) {
                    chamados.sort((a, b) => {
                        let valueA = a[currentSort];
                        let valueB = b[currentSort];
                        
                        // Converter datas para compara√ß√£o
                        if (currentSort.includes('data_')) {
                            valueA = new Date(valueA);
                            valueB = new Date(valueB);
                        }
                        
                        // Converter n√∫meros
                        if (currentSort === 'score_qualidade') {
                            valueA = parseInt(valueA);
                            valueB = parseInt(valueB);
                        }
                        
                        if (valueA < valueB) return sortDirection === 'asc' ? -1 : 1;
                        if (valueA > valueB) return sortDirection === 'asc' ? 1 : -1;
                        return 0;
                    });
                }
                
                renderizarChamados(chamados);
                atualizarPaginacao(data.total, chamados);
                
                // Verificar chamados cr√≠ticos para notifica√ß√µes
                verificarChamadosCriticos(chamados);
                
            } catch (error) {
                console.error('Erro ao carregar chamados:', error);
                document.getElementById('chamadosTableBody').innerHTML = 
                    '<tr><td colspan="8" class="error">Erro ao carregar chamados</td></tr>';
                
                mostrarToast('error', 'Erro', 'Falha ao carregar lista de chamados. Tente novamente.');
            }
        }

        function renderizarChamados(chamados) {
            console.log('üé® Renderizando chamados:', chamados);
            const tbody = document.getElementById('chamadosTableBody');
            console.log('üìã Elemento tbody encontrado:', tbody);
            
            if (!tbody) {
                console.error('‚ùå Elemento chamadosTableBody n√£o encontrado!');
                return;
            }
            
            if (!chamados || chamados.length === 0) {
                console.log('‚ö†Ô∏è Nenhum chamado para renderizar');
                tbody.innerHTML = '<tr><td colspan="8" class="loading">Nenhum chamado encontrado</td></tr>';
                return;
            }
            
            console.log('‚úÖ Renderizando', chamados.length, 'chamados');
            
            tbody.innerHTML = chamados.map(chamado => {
                // Mapear criticidades corretamente
                const criticidadeClass = {
                    'Alta': 'criticidade-alta',
                    'M√©dia': 'criticidade-media', 
                    'Baixa': 'criticidade-baixa',
                    'Cr√≠tica': 'criticidade-critica'
                }[chamado.criticidade] || '';
                
                // Mapear status corretamente
                const statusClass = {
                    'Aberto': 'status-aberto',
                    'Em an√°lise': 'status-em-analise',
                    'Em Andamento': 'status-em-andamento', 
                    'Pendente': 'status-pendente',
                    'Resolvido': 'status-resolvido',
                    'Fechado': 'status-fechado'
                }[chamado.status] || '';
                
                const score = parseInt(chamado.score_qualidade);
                const scoreClass = score >= 80 ? 'score-alto' : score >= 60 ? 'score-medio' : 'score-baixo';
                
                const dataAbertura = new Date(chamado.data_criacao).toLocaleString('pt-BR', {
                    day: '2-digit',
                    month: '2-digit',
                    year: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
                
                const dataUltimaAtualizacao = new Date(chamado.data_atualizacao || chamado.data_criacao).toLocaleString('pt-BR', {
                    day: '2-digit',
                    month: '2-digit',
                    year: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
                
                // Calcular badges din√¢micos
                const badges = calcularBadgesChamado(chamado);
                const badgesHtml = badges.map(badge => 
                    `<span class="badge ${badge.class}">${badge.text}</span>`
                ).join('');
                
                // Aplicar highlight na busca
                const termoBusca = document.getElementById('filtroBusca').value;
                const descricaoHighlight = aplicarHighlight(truncarTexto(chamado.descricao, 50), termoBusca);
                const clienteHighlight = aplicarHighlight(chamado.cliente_solicitante, termoBusca);
                
                return `
                    <tr onclick="abrirModalDetalhes(${chamado.id})" class="clickable-row">
                        <td>
                            <strong>${aplicarHighlight(chamado.numero_wex, termoBusca)}</strong>
                            <div class="chamado-badges">${badgesHtml}</div>
                        </td>
                        <td class="status-cell">
                            <span class="status-badge ${statusClass}">${chamado.status}</span>
                        </td>
                        <td class="titulo-cell" title="${chamado.descricao}">${descricaoHighlight}</td>
                        <td>${clienteHighlight}</td>
                        <td class="criticidade-cell">
                            <span class="criticidade-badge ${criticidadeClass}">${chamado.criticidade}</span>
                        </td>
                        <td class="score-cell">
                            <span class="score-badge ${scoreClass}">${score}%</span>
                        </td>
                        <td class="data-cell">${dataAbertura}</td>
                        <td class="data-cell">${dataUltimaAtualizacao}</td>
                    </tr>
                `;
            }).join('');
            
            // Atualizar √≠cones de ordena√ß√£o
            document.querySelectorAll('.sortable').forEach(th => {
                const icon = th.querySelector('.sort-icon');
                const field = th.dataset.sort;
                
                if (field === currentSort) {
                    icon.textContent = sortDirection === 'asc' ? '‚Üë' : '‚Üì';
                    icon.classList.add('active');
                } else {
                    icon.textContent = '‚Üï';
                    icon.classList.remove('active');
                }
            });
        }

        function renderizarPaginacao(currentPage, totalPages, totalItems) {
            const pagination = document.getElementById('pagination');
            
            if (totalPages <= 1) {
                pagination.innerHTML = '';
                return;
            }
            
            let paginationHtml = '';
            
            // Bot√£o anterior
            paginationHtml += `<button ${currentPage === 1 ? 'disabled' : ''} onclick="irParaPagina(${currentPage - 1})">‚Äπ Anterior</button>`;
            
            // P√°ginas
            for (let i = 1; i <= Math.min(totalPages, 5); i++) {
                paginationHtml += `<button class="${i === currentPage ? 'active' : ''}" onclick="irParaPagina(${i})">${i}</button>`;
            }
            
            if (totalPages > 5) {
                paginationHtml += '<button disabled>...</button>';
                paginationHtml += `<button onclick="irParaPagina(${totalPages})">${totalPages}</button>`;
            }
            
            // Bot√£o pr√≥ximo
            paginationHtml += `<button ${currentPage === totalPages ? 'disabled' : ''} onclick="irParaPagina(${currentPage + 1})">Pr√≥ximo ‚Ä∫</button>`;
            
            pagination.innerHTML = paginationHtml;
        }

        function irParaPagina(page) {
            paginaAtual = page;
            carregarChamados();
        }

        // Sistema de Notifica√ß√µes
        let notificationCount = 0;
        let criticalTickets = [];
        
        // Calcular badges para chamados
        function calcularBadgesChamado(chamado) {
            const badges = [];
            const agora = new Date();
            const dataAbertura = new Date(chamado.data_criacao);
            const horasDecorridas = (agora - dataAbertura) / (1000 * 60 * 60);
            
            // Badge de chamado novo (menos de 2 horas)
            if (horasDecorridas < 2) {
                badges.push({ class: 'badge-novo', text: 'NOVO' });
            }
            
            // Badges baseados em criticidade e tempo
            if (chamado.criticidade === 'Alta') {
                if (horasDecorridas > 24 && chamado.status !== 'Fechado') {
                    badges.push({ class: 'badge-critico-vencido', text: 'VENCIDO' });
                } else if (horasDecorridas > 18 && chamado.status !== 'Fechado') {
                    badges.push({ class: 'badge-critico-proximo', text: 'ATEN√á√ÉO' });
                }
            }
            
            // Badge de SLA OK
            if (chamado.status === 'Resolvido' || chamado.status === 'Fechado') {
                badges.push({ class: 'badge-sla-ok', text: 'OK' });
            }
            
            return badges;
        }
        
        // Mostrar toast notification
        function mostrarToast(tipo, titulo, mensagem, duracao = 5000) {
            const container = document.getElementById('toastContainer');
            const toastId = 'toast-' + Date.now();
            
            const toast = document.createElement('div');
            toast.className = `toast toast-${tipo}`;
            toast.id = toastId;
            
            toast.innerHTML = `
                <div class="toast-header">
                    <span class="toast-title">${titulo}</span>
                    <button class="toast-close" onclick="fecharToast('${toastId}')">&times;</button>
                </div>
                <div class="toast-body">${mensagem}</div>
            `;
            
            container.appendChild(toast);
            
            // Anima√ß√£o de entrada
            setTimeout(() => toast.classList.add('show'), 100);
            
            // Auto-remover ap√≥s duracao
            setTimeout(() => fecharToast(toastId), duracao);
            
            // Som opcional para alertas cr√≠ticos
            if (tipo === 'error' && 'speechSynthesis' in window) {
                // Pequeno beep usando Web Speech API (opcional)
                const utterance = new SpeechSynthesisUtterance('');
                utterance.volume = 0.1;
                utterance.rate = 10;
                speechSynthesis.speak(utterance);
            }
        }
        
        // Fechar toast
        function fecharToast(toastId) {
            const toast = document.getElementById(toastId);
            if (toast) {
                toast.classList.remove('show');
                setTimeout(() => toast.remove(), 300);
            }
        }
        
        // Mostrar banner de alerta
        function mostrarAlertBanner(tipo, mensagem) {
            const banner = document.getElementById('alertBanner');
            const container = document.querySelector('.container');
            
            banner.className = `alert-banner ${tipo}`;
            banner.textContent = mensagem;
            banner.style.display = 'block';
            
            // Adicionar classe para ajustar margem do container
            if (container) {
                container.classList.add('with-alert');
            }
            
            // Auto-ocultar ap√≥s 15 segundos
            setTimeout(() => {
                banner.style.display = 'none';
                if (container) {
                    container.classList.remove('with-alert');
                }
            }, 15000);
        }
        
        // Carregar e verificar notifica√ß√µes reais
        async function carregarNotificacoesReais() {
            try {
                const response = await fetch(`${API_BASE}/chamados?limit=100`);
                const data = await response.json();
                
                const agora = new Date();
                let criticosVencidos = 0;
                let altosProximosVencimento = 0;
                let novosHoje = 0;
                
                // SLA por criticidade (em horas)
                const slaHoras = {
                    'Cr√≠tica': 4,
                    'Alta': 8,
                    'M√©dia': 24,
                    'Baixa': 48
                };
                
                data.chamados.forEach(chamado => {
                    // Pular chamados j√° resolvidos/fechados
                    if (['Resolvido', 'Fechado'].includes(chamado.status)) return;
                    
                    const dataCriacao = new Date(chamado.data_criacao);
                    const horasDecorridas = (agora - dataCriacao) / (1000 * 60 * 60);
                    const slaLimite = slaHoras[chamado.criticidade] || 24;
                    
                    // Verificar SLA vencido
                    if (horasDecorridas > slaLimite) {
                        if (chamado.criticidade === 'Cr√≠tica') {
                            criticosVencidos++;
                        }
                    }
                    
                    // Verificar pr√≥ximos ao vencimento (75% do SLA)
                    if (horasDecorridas > (slaLimite * 0.75) && horasDecorridas <= slaLimite) {
                        if (chamado.criticidade === 'Alta') {
                            altosProximosVencimento++;
                        }
                    }
                    
                    // Verificar chamados novos hoje
                    const hojeInicio = new Date();
                    hojeInicio.setHours(0, 0, 0, 0);
                    if (dataCriacao >= hojeInicio) {
                        novosHoje++;
                    }
                });
                
                // Atualizar contador de notifica√ß√µes
                notificationCount = criticosVencidos + altosProximosVencimento + (novosHoje > 10 ? 1 : 0);
                atualizarContadorNotificacoes();
                
                // Mostrar alertas baseados nos dados reais
                if (criticosVencidos > 0) {
                    mostrarAlertBanner('error', 
                        `‚ö†Ô∏è ${criticosVencidos} chamado(s) cr√≠tico(s) com SLA vencido! A√ß√£o imediata necess√°ria.`);
                } else if (altosProximosVencimento > 0) {
                    mostrarAlertBanner('warning', 
                        `üïê ${altosProximosVencimento} chamado(s) de alta prioridade pr√≥ximos ao vencimento.`);
                } else if (novosHoje > 15) {
                    mostrarAlertBanner('info', 
                        `üìà Alto volume de chamados hoje: ${novosHoje} novos chamados.`);
                }
                
                console.log('üîî Notifica√ß√µes carregadas:', {
                    criticosVencidos,
                    altosProximosVencimento,
                    novosHoje,
                    totalNotificacoes: notificationCount
                });
                
            } catch (error) {
                console.error('Erro ao carregar notifica√ß√µes:', error);
            }
        }
        
        // Atualizar contador de notifica√ß√µes
        function atualizarContadorNotificacoes() {
            const badge = document.getElementById('notificationBadge');
            
            if (notificationCount > 0) {
                badge.textContent = notificationCount > 99 ? '99+' : notificationCount;
                badge.classList.remove('hidden');
            } else {
                badge.classList.add('hidden');
            }
        }
        
        // Toggle painel de notifica√ß√µes (placeholder para implementa√ß√£o futura)
        function toggleNotificationPanel() {
            mostrarToast('info', 'Notifica√ß√µes', `Voc√™ tem ${notificationCount} notifica√ß√µes pendentes`);
        }
        
        // Verificar chamados cr√≠ticos
        function verificarChamadosCriticos(chamados) {
            const agora = new Date();
            let criticosVencidos = 0;
            let criticosProximos = 0;
            
            chamados.forEach(chamado => {
                const dataAbertura = new Date(chamado.data_criacao);
                const horasDecorridas = (agora - dataAbertura) / (1000 * 60 * 60);
                
                if (chamado.criticidade === 'Alta' && chamado.status !== 'Fechado') {
                    if (horasDecorridas > 24) {
                        criticosVencidos++;
                    } else if (horasDecorridas > 18) {
                        criticosProximos++;
                    }
                }
            });
            
            // Atualizar contador
            notificationCount = criticosVencidos + criticosProximos;
            atualizarContadorNotificacoes();
            
            // Mostrar alertas se necess√°rio
            if (criticosVencidos > 0) {
                mostrarAlertBanner('error', 
                    `‚ö†Ô∏è ${criticosVencidos} chamado(s) cr√≠tico(s) vencido(s)! A√ß√£o imediata necess√°ria.`);
            } else if (criticosProximos > 0) {
                mostrarAlertBanner('warning', 
                    `‚è∞ ${criticosProximos} chamado(s) cr√≠tico(s) pr√≥ximo(s) do vencimento.`);
            }
        }
        
        // Estados de loading
        function mostrarLoading(elemento, texto = 'Carregando...') {
            elemento.innerHTML = `
                <div class="loading-state">
                    <div class="loading-spinner"></div>
                    ${texto}
                </div>
            `;
        }
        
        function ocultarLoading(elemento) {
            const loading = elemento.querySelector('.loading-state');
            if (loading) {
                loading.remove();
            }
        }
        
        // Fun√ß√£o de ordena√ß√£o
        function ordenarTabela(campo) {
            if (currentSort === campo) {
                sortDirection = sortDirection === 'asc' ? 'desc' : 'asc';
            } else {
                currentSort = campo;
                sortDirection = 'asc';
            }
            
            carregarChamados();
        }
        
        // Fun√ß√£o para carregar clientes no dropdown
        async function carregarClientesDropdown() {
            try {
                const response = await fetch(`${API_BASE}/chamados?limit=100`);
                const data = await response.json();
                
                // Extrair lista √∫nica de clientes dos chamados
                const clientesUnicos = [...new Set(data.chamados.map(chamado => chamado.cliente_solicitante))].sort();
                
                const dropdown = document.getElementById('filtroClienteDropdown');
                dropdown.innerHTML = '<option value="">Todos os clientes</option>';
                
                clientesUnicos.forEach(cliente => {
                    const option = document.createElement('option');
                    option.value = cliente;
                    option.textContent = cliente;
                    dropdown.appendChild(option);
                });
            } catch (error) {
                console.error('Erro ao carregar clientes:', error);
            }
        }
        
        // Fun√ß√£o para limpar filtros
        function limparFiltros() {
            document.getElementById('filtroStatus').selectedIndex = -1;
            document.getElementById('filtroCriticidade').selectedIndex = -1;
            document.getElementById('filtroClienteDropdown').value = '';
            document.getElementById('filtroBusca').value = '';
            document.getElementById('filtroDataInicio').value = '';
            document.getElementById('filtroDataFim').value = '';
            
            // Reiniciar ordena√ß√£o
            currentSort = null;
            sortDirection = 'asc';
            
            carregarChamados();
            
            mostrarToast('success', 'Filtros Limpos', 'Todos os filtros foram removidos com sucesso.');
        }
        
        // Fun√ß√£o de busca avan√ßada
        function aplicarBuscaAvancada() {
            carregarChamados();
        }

        function truncarTexto(texto, limite) {
            return texto.length > limite ? texto.substring(0, limite) + '...' : texto;
        }

        function formatarData(dataISO) {
            const data = new Date(dataISO);
            return data.toLocaleDateString('pt-BR') + ' ' + data.toLocaleTimeString('pt-BR', {hour: '2-digit', minute: '2-digit'});
        }

        // ===== FUN√á√ïES DA SE√á√ÉO IA =====
        let currentModule = 'triagem';
        let chamadoIdSelecionadoTriagem = null;
        let sugestaoIndexSelecionado = null;

        // Navega√ß√£o entre m√≥dulos de IA
        function mostrarModuloIA(modulo) {
            // Ocultar todos os m√≥dulos
            document.querySelectorAll('.ia-module').forEach(m => m.classList.add('hidden'));
            document.querySelectorAll('.ia-nav-btn').forEach(btn => btn.classList.remove('active'));
            
            // Mostrar m√≥dulo selecionado
            document.getElementById(`modulo${modulo.charAt(0).toUpperCase() + modulo.slice(1)}`).classList.remove('hidden');
            document.querySelector(`[onclick="mostrarModuloIA('${modulo}')"]`).classList.add('active');
            
            currentModule = modulo;
            
            // Carregar dados espec√≠ficos do m√≥dulo
            carregarDadosModuloIA(modulo);
        }

        // Carregar dados espec√≠ficos para cada m√≥dulo
        async function carregarDadosModuloIA(modulo) {
            switch(modulo) {
                case 'triagem':
                case 'sugestoes':
                case 'relacionados':
                    await carregarChamadosParaIA(modulo);
                    break;
                case 'relatorios':
                    // Dados carregados sob demanda
                    break;
            }
        }

        // Carregar lista de chamados para sele√ß√£o nos m√≥dulos de IA
        async function carregarChamadosParaIA(modulo) {
            try {
                const response = await fetch(`${API_BASE}/chamados?size=100`);
                const data = await response.json();
                
                let selectId;
                switch(modulo) {
                    case 'triagem':
                        selectId = 'selectChamadoTriagem';
                        break;
                    case 'sugestoes':
                        selectId = 'selectChamadoSugestao';
                        break;
                    case 'relacionados':
                        selectId = 'selectChamadoRelacionado';
                        break;
                }
                
                const select = document.getElementById(selectId);
                select.innerHTML = '<option value="">Selecione um chamado...</option>';
                
                // Verificar se os dados existem e se h√° chamados
                if (data && data.chamados && Array.isArray(data.chamados)) {
                    data.chamados.forEach(chamado => {
                        const option = document.createElement('option');
                        option.value = chamado.id;
                        option.textContent = `#${chamado.numero_wex} - ${truncarTexto(chamado.descricao, 60)} (${chamado.cliente_solicitante})`;
                        select.appendChild(option);
                    });
                } else {
                    console.warn('Dados de chamados n√£o encontrados ou malformados:', data);
                    const option = document.createElement('option');
                    option.value = '';
                    option.textContent = 'Nenhum chamado encontrado';
                    select.appendChild(option);
                }
                
            } catch (error) {
                console.error('Erro ao carregar chamados para IA:', error);
                mostrarToast('error', 'Erro', 'Erro ao carregar chamados');
            }
        }

        // ===== M√ìDULO DE TRIAGEM AUTOM√ÅTICA =====
        async function executarTriagem() {
            const selectChamado = document.getElementById('selectChamadoTriagem');
            const chamadoId = selectChamado.value;
            
            if (!chamadoId) {
                mostrarToast('warning', 'Aten√ß√£o', 'Selecione um chamado para triagem');
                return;
            }
            
            chamadoIdSelecionadoTriagem = chamadoId;
            
            try {
                // Mostrar loading
                mostrarToast('info', 'Processando', 'Executando triagem autom√°tica...');
                
                const response = await fetch(`${API_BASE}/api/chamados/${chamadoId}/triagem`, {
                    method: 'POST'
                });
                
                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`Erro na triagem autom√°tica: ${response.status} - ${errorText}`);
                }
                
                const resultado = await response.json();
                
                // Log para debug
                console.log('ü§ñ Resposta da API de triagem:', resultado);
                
                if (!resultado) {
                    throw new Error('Resposta vazia da API de triagem');
                }
                
                exibirResultadoTriagem(resultado);
                mostrarToast('success', 'Sucesso', 'Triagem autom√°tica executada com sucesso!');
                
            } catch (error) {
                console.error('Erro na triagem:', error);
                mostrarToast('error', 'Erro', `Erro ao executar triagem autom√°tica: ${error.message}`);
                
                // Limpar resultado anterior em caso de erro
                document.getElementById('resultadoTriagem').classList.add('hidden');
            }
        }

        function exibirResultadoTriagem(resultado) {
            document.getElementById('resultadoTriagem').classList.remove('hidden');
            
            // Atualizar informa√ß√µes b√°sicas
            document.getElementById('criticidadeAtual').textContent = resultado.criticidade_atual || 'N/A';
            document.getElementById('criticidadeAtual').className = `badge badge-ia ${(resultado.criticidade_atual || 'media').toLowerCase()}`;
            
            document.getElementById('criticidadeSugerida').textContent = resultado.criticidade_sugerida || 'N/A';
            document.getElementById('criticidadeSugerida').className = `badge badge-ia ${(resultado.criticidade_sugerida || 'media').toLowerCase()}`;
            
            document.getElementById('confiancaTriagem').textContent = `${((resultado.confianca || 0) * 100).toFixed(1)}%`;
            document.getElementById('scoreQualidade').textContent = `${resultado.score_qualidade_sugerido || resultado.score_total || 0}/100`;
            
            // Fatores identificados - usando o campo correto da API
            const fatoresContainer = document.getElementById('fatoresLista');
            fatoresContainer.innerHTML = '';
            const fatores = resultado.fatores_identificados || resultado.motivos || [];
            if (fatores.length > 0) {
                fatores.forEach(fator => {
                    const div = document.createElement('div');
                    div.className = 'fator-item';
                    div.textContent = fator;
                    fatoresContainer.appendChild(div);
                });
            } else {
                fatoresContainer.innerHTML = '<div class="fator-item">Nenhum fator espec√≠fico identificado</div>';
            }
            
            // Sugest√µes de melhoria - usando o campo correto da API
            const sugestoesContainer = document.getElementById('sugestoesLista');
            sugestoesContainer.innerHTML = '';
            const sugestoes = resultado.sugestoes_melhoria || resultado.sugestoes || [];
            if (sugestoes.length > 0) {
                sugestoes.forEach(sugestao => {
                    const div = document.createElement('div');
                    div.className = 'sugestao-item';
                    div.textContent = sugestao;
                    sugestoesContainer.appendChild(div);
                });
            } else {
                sugestoesContainer.innerHTML = '<div class="sugestao-item">Nenhuma sugest√£o espec√≠fica de melhoria</div>';
            }
            
            // Tags sugeridas - usando o campo correto da API
            const tagsContainer = document.getElementById('tagsLista');
            tagsContainer.innerHTML = '';
            const tags = resultado.tags_sugeridas || [];
            if (tags.length > 0) {
                tags.forEach(tag => {
                    const span = document.createElement('span');
                    span.className = 'tag-item badge badge-secondary';
                    span.textContent = tag;
                    span.style.margin = '2px';
                    span.style.display = 'inline-block';
                    tagsContainer.appendChild(span);
                });
            } else {
                tagsContainer.innerHTML = '<span class="tag-item badge badge-light">Nenhuma tag sugerida</span>';
            }
            
            // Log para debug
            console.log('üìä Resultado da triagem processado:', {
                fatores: fatores.length,
                sugestoes: sugestoes.length,
                tags: tags.length,
                resultado: resultado
            });
        }

        async function aplicarTriagem() {
            if (!chamadoIdSelecionadoTriagem) {
                mostrarToast('warning', 'Aten√ß√£o', 'Nenhuma triagem para aplicar');
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE}/api/triagem/aplicar/${chamadoIdSelecionadoTriagem}`, {
                    method: 'POST'
                });
                
                if (!response.ok) {
                    throw new Error('Erro ao aplicar triagem');
                }
                
                const resultado = await response.json();
                mostrarToast('success', 'Sucesso', 'Triagem aplicada com sucesso!');
                
                // Atualizar interface
                carregarChamados();
                carregarDashboard();
                
            } catch (error) {
                console.error('Erro ao aplicar triagem:', error);
                mostrarToast('error', 'Erro', 'Erro ao aplicar triagem');
            }
        }

        function limparTriagem() {
            document.getElementById('resultadoTriagem').classList.add('hidden');
            document.getElementById('selectChamadoTriagem').value = '';
            chamadoIdSelecionadoTriagem = null;
        }

        // ===== M√ìDULO DE SUGEST√ïES DE FOLLOW-UP =====
        async function obterSugestoes() {
            const selectChamado = document.getElementById('selectChamadoSugestao');
            const chamadoId = selectChamado.value;
            
            if (!chamadoId) {
                mostrarToast('warning', 'Aten√ß√£o', 'Selecione um chamado para obter sugest√µes');
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE}/api/chamados/${chamadoId}/sugestoes-followup`);
                
                if (!response.ok) {
                    throw new Error('Erro ao obter sugest√µes');
                }
                
                const resultado = await response.json();
                exibirResultadoSugestoes(resultado);
                
            } catch (error) {
                console.error('Erro ao obter sugest√µes:', error);
                mostrarToast('error', 'Erro', 'Erro ao obter sugest√µes de follow-up');
            }
        }

        function exibirResultadoSugestoes(resultado) {
            document.getElementById('resultadoSugestoes').classList.remove('hidden');
            
            // Contexto do chamado
            const contextoContainer = document.getElementById('contextoChamado');
            contextoContainer.innerHTML = `
                <div class="contexto-item">
                    <strong>Status:</strong> ${resultado.contexto.status_atual}<br>
                    <strong>Criticidade:</strong> ${resultado.contexto.criticidade}<br>
                    <strong>Tempo desde cria√ß√£o:</strong> ${resultado.contexto.tempo_desde_criacao_horas.toFixed(1)} horas<br>
                    <strong>Follow-ups existentes:</strong> ${resultado.contexto.total_followups_existentes}
                </div>
            `;
            
            // Sugest√µes principais
            const sugestoesContainer = document.getElementById('sugestoesPrincipais');
            sugestoesContainer.innerHTML = '';
            resultado.sugestoes_principais.forEach((sugestao, index) => {
                const div = document.createElement('div');
                div.className = 'sugestao-item';
                div.innerHTML = `
                    <div onclick="selecionarSugestao(${index})" style="cursor: pointer;">
                        ${sugestao}
                    </div>
                `;
                sugestoesContainer.appendChild(div);
            });
            
            // Exemplos do hist√≥rico
            const exemploContainer = document.getElementById('exemplosSimilares');
            exemploContainer.innerHTML = '';
            resultado.exemplos_historico.forEach(exemplo => {
                const div = document.createElement('div');
                div.className = 'exemplo-historico';
                div.innerHTML = `
                    <strong>Chamado Similar #${exemplo.chamado_similar_id}</strong>
                    <small>(Similaridade: ${(exemplo.score_similaridade * 100).toFixed(1)}%)</small>
                    <ul>
                        ${exemplo.followups.map(f => `<li><strong>${f.tipo}:</strong> ${f.descricao}</li>`).join('')}
                    </ul>
                `;
                exemploContainer.appendChild(div);
            });
            
            // Salvar dados para uso posterior
            window.dadosSugestaoAtual = resultado;
        }

        function selecionarSugestao(index) {
            sugestaoIndexSelecionado = index;
            
            // Destacar sugest√£o selecionada
            document.querySelectorAll('#sugestoesPrincipais .sugestao-item').forEach((item, i) => {
                if (i === index) {
                    item.style.background = '#c8e6c9';
                    item.style.borderLeft = '4px solid #4caf50';
                } else {
                    item.style.background = '#f3e5f5';
                    item.style.borderLeft = '3px solid #9c27b0';
                }
            });
        }

        async function criarFollowupSugerido() {
            if (sugestaoIndexSelecionado === null) {
                mostrarToast('warning', 'Aten√ß√£o', 'Selecione uma sugest√£o primeiro');
                return;
            }
            
            const chamadoId = document.getElementById('selectChamadoSugestao').value;
            const autor = prompt('Digite seu nome:');
            
            if (!autor) {
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE}/api/chamados/${chamadoId}/followup-sugerido`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        sugestao_index: sugestaoIndexSelecionado,
                        autor: autor
                    })
                });
                
                if (!response.ok) {
                    throw new Error('Erro ao criar follow-up');
                }
                
                const resultado = await response.json();
                mostrarToast('success', 'Sucesso', 'Follow-up criado com sucesso!');
                
                // Resetar sele√ß√£o
                sugestaoIndexSelecionado = null;
                document.querySelectorAll('#sugestoesPrincipais .sugestao-item').forEach(item => {
                    item.style.background = '#f3e5f5';
                    item.style.borderLeft = '3px solid #9c27b0';
                });
                
            } catch (error) {
                console.error('Erro ao criar follow-up:', error);
                mostrarToast('error', 'Erro', 'Erro ao criar follow-up sugerido');
            }
        }

        // ===== M√ìDULO DE CHAMADOS RELACIONADOS =====
        function atualizarScoreMinimo() {
            const slider = document.getElementById('scoreMinimo');
            const display = document.getElementById('scoreValor');
            display.textContent = slider.value;
        }

        async function buscarRelacionados() {
            const selectChamado = document.getElementById('selectChamadoRelacionado');
            const chamadoId = selectChamado.value;
            const scoreMinimo = document.getElementById('scoreMinimo').value;
            const limite = document.getElementById('limiteResultados').value;
            
            if (!chamadoId) {
                mostrarToast('warning', 'Aten√ß√£o', 'Selecione um chamado para an√°lise');
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE}/api/chamados/${chamadoId}/relacionados?score_minimo=${scoreMinimo}&limite=${limite}`);
                
                if (!response.ok) {
                    throw new Error('Erro ao buscar chamados relacionados');
                }
                
                const resultado = await response.json();
                exibirResultadoRelacionados(resultado);
                
            } catch (error) {
                console.error('Erro ao buscar relacionados:', error);
                mostrarToast('error', 'Erro', 'Erro ao buscar chamados relacionados');
            }
        }

        function exibirResultadoRelacionados(resultado) {
            document.getElementById('resultadoRelacionados').classList.remove('hidden');
            
            // Chamado principal
            const principalContainer = document.getElementById('chamadoPrincipalInfo');
            principalContainer.innerHTML = `
                <div class="chamado-principal">
                    <strong>#${resultado.chamado_principal.numero_wex}</strong> - ${resultado.chamado_principal.cliente}<br>
                    <small>${resultado.chamado_principal.descricao}</small><br>
                    <span class="badge badge-ia ${resultado.chamado_principal.criticidade.toLowerCase()}">${resultado.chamado_principal.criticidade}</span>
                    <span class="badge">${resultado.chamado_principal.status}</span>
                </div>
            `;
            
            // Lista de relacionados
            const relacionadosContainer = document.getElementById('listaRelacionados');
            relacionadosContainer.innerHTML = '';
            
            if (resultado.chamados_similares.length === 0) {
                relacionadosContainer.innerHTML = '<p>Nenhum chamado relacionado encontrado com os crit√©rios especificados.</p>';
            } else {
                resultado.chamados_similares.forEach(relacionado => {
                    const div = document.createElement('div');
                    div.className = 'relacionado-item';
                    div.innerHTML = `
                        <div class="relacionado-header">
                            <strong>#${relacionado.numero_wex}</strong> - ${relacionado.cliente}
                            <span class="relacionado-score">${(relacionado.score_similaridade * 100).toFixed(1)}%</span>
                        </div>
                        <div>${relacionado.descricao}</div>
                        <div class="relacionado-status">
                            <span class="badge badge-ia ${relacionado.criticidade.toLowerCase()}">${relacionado.criticidade}</span>
                            <span class="badge">${relacionado.status}</span>
                            <small>${formatarData(relacionado.data_criacao)}</small>
                        </div>
                        <div class="relacionado-motivos">
                            ${relacionado.motivos.map(motivo => `<span class="motivo-tag">${motivo}</span>`).join('')}
                        </div>
                    `;
                    relacionadosContainer.appendChild(div);
                });
            }
            
            // Padr√µes identificados
            const padroesContainer = document.getElementById('padroesLista');
            padroesContainer.innerHTML = '';
            resultado.padroes_identificados.forEach(padrao => {
                const div = document.createElement('div');
                div.className = 'padrao-item';
                div.textContent = padrao;
                padroesContainer.appendChild(div);
            });
        }

        // ===== M√ìDULO DE RELAT√ìRIOS DE IA =====
        async function gerarRelatorioIA() {
            const periodo = document.getElementById('periodoAnalise').value;
            
            try {
                const response = await fetch(`${API_BASE}/api/relatorios/padroes-ia?dias=${periodo}`);
                
                if (!response.ok) {
                    throw new Error('Erro ao gerar relat√≥rio');
                }
                
                const resultado = await response.json();
                exibirRelatorioIA(resultado);
                
            } catch (error) {
                console.error('Erro ao gerar relat√≥rio:', error);
                mostrarToast('error', 'Erro', 'Erro ao gerar relat√≥rio de IA');
            }
        }

        function exibirRelatorioIA(resultado) {
            document.getElementById('resultadoRelatorio').classList.remove('hidden');
            
            // M√©tricas principais
            document.getElementById('totalChamadosPeriodo').textContent = resultado.total_chamados;
            document.getElementById('totalGruposSimilares').textContent = resultado.total_grupos_similares;
            document.getElementById('clientesAtivos').textContent = resultado.clientes_mais_ativos.length;
            
            // Padr√µes globais
            const padroesContainer = document.getElementById('padroesGlobais');
            padroesContainer.innerHTML = '';
            if (resultado.padroes_globais.length === 0) {
                padroesContainer.innerHTML = '<p>Nenhum padr√£o espec√≠fico identificado no per√≠odo.</p>';
            } else {
                resultado.padroes_globais.forEach(padrao => {
                    const div = document.createElement('div');
                    div.className = 'padrao-item';
                    div.textContent = padrao;
                    padroesContainer.appendChild(div);
                });
            }
            
            // Distribui√ß√£o por criticidade
            const criticidadeContainer = document.getElementById('graficoCriticidade');
            criticidadeContainer.innerHTML = '';
            Object.entries(resultado.distribuicao_criticidade).forEach(([criticidade, count]) => {
                const div = document.createElement('div');
                div.style.display = 'flex';
                div.style.justifyContent = 'space-between';
                div.style.padding = '0.5rem';
                div.style.background = 'white';
                div.style.marginBottom = '0.5rem';
                div.style.borderRadius = '4px';
                div.innerHTML = `
                    <span class="badge badge-ia ${criticidade.toLowerCase()}">${criticidade}</span>
                    <strong>${count} chamados</strong>
                `;
                criticidadeContainer.appendChild(div);
            });
            
            // Ranking de clientes
            const clientesContainer = document.getElementById('rankingClientes');
            clientesContainer.innerHTML = '';
            resultado.clientes_mais_ativos.forEach((cliente, index) => {
                const div = document.createElement('div');
                div.style.display = 'flex';
                div.style.justifyContent = 'space-between';
                div.style.padding = '0.5rem';
                div.style.background = 'white';
                div.style.marginBottom = '0.5rem';
                div.style.borderRadius = '4px';
                div.innerHTML = `
                    <span><strong>#${index + 1}</strong> ${cliente.cliente}</span>
                    <span class="badge badge-secondary">${cliente.total_chamados} chamados</span>
                `;
                clientesContainer.appendChild(div);
            });
        }

        // Inicializar se√ß√£o IA na carga da p√°gina
        document.addEventListener('DOMContentLoaded', function() {
            // Event listeners para inputs
            document.getElementById('scoreMinimo').addEventListener('input', atualizarScoreMinimo);
            
            // Carregar dados iniciais
            carregarDadosModuloIA('triagem');
        });

        // Auto-refresh a cada 30 segundos
        setInterval(() => {
            carregarDashboard();
            carregarDashboardAvancado();
            carregarChamados();
        }, 30000000);
    </script>

    <!-- Modal para detalhes do chamado -->
    <div id="chamadoModal" class="modal" style="display: none;">
        <!-- Conte√∫do ser√° inserido dinamicamente -->
    </div>

</body>
</html>